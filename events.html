<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#060810" />
  <title>NEXUS // Events</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Space+Mono:wght@400;700&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg0:#060810; --bg1:#0a0d18; --bg2:#0d1120;
      --card:rgba(13,17,32,.82); --card2:rgba(10,13,24,.92);
      --surface:rgba(255,255,255,.04); --surface2:rgba(255,255,255,.07);
      --border:rgba(255,255,255,.08); --border2:rgba(255,255,255,.14);
      --text:#e2e8f4; --muted:#7b8ba8; --muted2:#a0aec0;
      --accent:#3b82f6; --accent2:#06b6d4;
      --ok:#10b981; --warn:#f59e0b; --danger:#ef4444; --live:#22c55e; --gold:#fbbf24;
      --r:16px; --r2:12px; --r3:8px;
      --shadow:0 24px 64px rgba(0,0,0,.6); --shadow2:0 8px 32px rgba(0,0,0,.4);
      --glow-live:0 0 20px rgba(34,197,94,.3); --glow-gold:0 0 20px rgba(251,191,36,.25);
      --logo-size:clamp(72px,9vw,108px);
      --font-d:'Rajdhani',sans-serif; --font-m:'Space Mono',monospace; --font-b:'DM Sans',sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:var(--font-b);color:var(--text);background:var(--bg0);
      background-image:
        radial-gradient(ellipse 1400px 600px at 5% 0%,rgba(59,130,246,.08),transparent 60%),
        radial-gradient(ellipse 800px 600px at 95% 10%,rgba(6,182,212,.07),transparent 55%),
        radial-gradient(ellipse 600px 400px at 50% 100%,rgba(139,92,246,.06),transparent 50%);
      overflow-x:hidden; min-height:100vh;
    }
    body::before{
      content:"";position:fixed;inset:0;pointer-events:none;z-index:0;
      background-image:linear-gradient(rgba(59,130,246,.03) 1px,transparent 1px),
        linear-gradient(90deg,rgba(59,130,246,.03) 1px,transparent 1px);
      background-size:48px 48px;
    }
    .wrap{position:relative;z-index:1;max-width:1040px;margin:0 auto;padding:0 18px 80px}

    /* TOPBAR */
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:16px 0;margin-bottom:28px;border-bottom:1px solid var(--border)}
    .topbar-left{display:flex;align-items:center;gap:14px}
    .brand{font-family:var(--font-d);font-size:22px;font-weight:700;letter-spacing:.08em;
      color:var(--text);text-decoration:none;text-transform:uppercase}
    .brand span{color:var(--accent)}
    .sep{width:1px;height:24px;background:var(--border2)}
    .breadcrumb{font-family:var(--font-m);font-size:11px;color:var(--muted);letter-spacing:.05em}
    .topbar-right{display:flex;align-items:center;gap:8px;flex-wrap:wrap}

    /* STATUS CHIP */
    .status-chip{display:inline-flex;align-items:center;gap:7px;padding:5px 11px;
      border-radius:999px;border:1px solid var(--border2);background:var(--surface);
      font-family:var(--font-m);font-size:10px;letter-spacing:.04em;
      cursor:default;user-select:none;white-space:nowrap}
    .s-dot{width:7px;height:7px;border-radius:50%;background:var(--muted);
      transition:background .3s,box-shadow .3s}
    .s-dot.ok{background:var(--ok);box-shadow:0 0 8px rgba(16,185,129,.5)}
    .s-dot.loading{background:var(--warn);box-shadow:0 0 8px rgba(245,158,11,.4);
      animation:blink 1s ease-in-out infinite}
    .s-dot.err{background:var(--danger)}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

    /* BUTTONS */
    .btn{display:inline-flex;align-items:center;gap:7px;padding:8px 14px;
      border-radius:var(--r3);border:1px solid var(--border2);background:var(--surface);
      color:var(--text);font-family:var(--font-b);font-size:13px;font-weight:600;
      cursor:pointer;outline:none;text-decoration:none;
      transition:all .18s ease;white-space:nowrap;user-select:none}
    .btn:hover{background:var(--surface2);border-color:rgba(255,255,255,.22);transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn:focus-visible{box-shadow:0 0 0 3px rgba(59,130,246,.4)}
    .btn.primary{background:rgba(59,130,246,.18);border-color:rgba(59,130,246,.35);color:#93c5fd}
    .btn.primary:hover{background:rgba(59,130,246,.28)}
    .btn.success{background:rgba(16,185,129,.15);border-color:rgba(16,185,129,.35);color:#6ee7b7}
    .btn.success:hover{background:rgba(16,185,129,.25)}
    .btn.danger{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.30);color:#fca5a5}
    .btn.danger:hover{background:rgba(239,68,68,.22)}
    .btn.warn{background:rgba(245,158,11,.12);border-color:rgba(245,158,11,.30);color:#fcd34d}
    .btn.warn:hover{background:rgba(245,158,11,.22)}
    .btn.ghost{background:transparent;border-color:transparent}
    .btn.ghost:hover{background:var(--surface);border-color:var(--border)}
    .btn.active-on{background:rgba(59,130,246,.2);border-color:rgba(59,130,246,.45);color:#93c5fd}

    /* PAGE HEADER */
    .page-header{display:flex;align-items:flex-start;justify-content:space-between;
      gap:20px;flex-wrap:wrap;margin-bottom:20px}
    .page-eyebrow{font-family:var(--font-m);font-size:10px;letter-spacing:.15em;
      color:var(--accent);text-transform:uppercase;margin-bottom:6px}
    .page-title{font-family:var(--font-d);font-size:clamp(32px,5vw,52px);font-weight:700;
      letter-spacing:-.01em;line-height:1;text-transform:uppercase}
    .page-title span{color:var(--accent)}
    .page-sub{margin-top:8px;font-size:14px;color:var(--muted2);max-width:60ch;line-height:1.6}
    .page-sub code{font-family:var(--font-m);font-size:12px;color:var(--accent);
      padding:1px 5px;border-radius:4px;background:rgba(59,130,246,.1)}
    .page-actions{display:flex;align-items:center;gap:8px;flex-wrap:wrap;padding-top:4px}

    /* STATS BAR */
    .stats-bar{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;margin-bottom:20px}
    .stat-card{border:1px solid var(--border);border-radius:var(--r2);background:var(--card);
      padding:12px 14px;backdrop-filter:blur(12px)}
    .stat-label{font-family:var(--font-m);font-size:9px;letter-spacing:.12em;text-transform:uppercase;
      color:var(--muted);margin-bottom:4px}
    .stat-value{font-family:var(--font-d);font-size:26px;font-weight:700;line-height:1}
    .sv-blue{color:#60a5fa} .sv-green{color:#34d399} .sv-gold{color:#fbbf24} .sv-purple{color:#a78bfa}

    /* PANEL */
    .panel{border:1px solid var(--border);border-radius:var(--r);background:var(--card);
      backdrop-filter:blur(16px);box-shadow:var(--shadow2);overflow:hidden;margin-bottom:20px}
    .panel-header{display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 18px;border-bottom:1px solid var(--border);background:rgba(255,255,255,.02)}
    .panel-title{font-family:var(--font-d);font-size:16px;font-weight:700;
      letter-spacing:.04em;text-transform:uppercase}
    .panel-hint{font-family:var(--font-m);font-size:10px;color:var(--muted);letter-spacing:.04em}
    .panel-body{padding:18px}

    /* FORM */
    .form-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
    .form-group{display:flex;flex-direction:column;gap:6px}
    .form-group.span2{grid-column:span 2}
    label{font-family:var(--font-m);font-size:10px;letter-spacing:.1em;text-transform:uppercase;
      color:var(--muted2);display:block}
    input,select{
      width:100%;padding:10px 13px;border-radius:var(--r3);
      background:rgba(0,0,0,.3);border:1px solid var(--border2);
      color:var(--text);font-family:var(--font-b);font-size:14px;outline:none;
      transition:border-color .15s,box-shadow .15s}
    input:focus,select:focus{border-color:rgba(59,130,246,.5);box-shadow:0 0 0 3px rgba(59,130,246,.12)}
    select option{background:var(--bg2)}
    input[type="file"]{padding:8px 12px;font-size:13px;color:var(--muted2)}
    input[type="number"]{-moz-appearance:textfield}
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none}

    .upload-pair{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
    .upload-box{border:1px dashed var(--border2);border-radius:var(--r3);padding:12px;
      text-align:center;cursor:pointer;position:relative;
      background:rgba(0,0,0,.15);transition:border-color .15s,background .15s}
    .upload-box:hover{border-color:rgba(59,130,246,.4);background:rgba(59,130,246,.05)}
    .upload-box input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
    .upload-box-icon{font-size:20px;margin-bottom:4px}
    .upload-box-label{font-size:11px;color:var(--muted2);font-family:var(--font-m);letter-spacing:.05em}
    .upload-preview{width:100%;max-height:60px;object-fit:contain;border-radius:6px;display:none;margin-top:4px}

    .location-row{display:flex;gap:10px;align-items:center}
    .flag-up{width:42px;height:42px;flex:0 0 42px;border-radius:var(--r3);
      border:1px solid var(--border2);background:rgba(0,0,0,.25);
      display:grid;place-items:center;cursor:pointer;position:relative;overflow:hidden;
      transition:border-color .15s,box-shadow .15s}
    .flag-up:hover{border-color:rgba(59,130,246,.4);box-shadow:0 0 24px rgba(59,130,246,.25)}
    .flag-up img{width:100%;height:100%;object-fit:contain}
    .flag-emoji{font-size:18px}
    .flag-badge{position:absolute;bottom:2px;right:2px;font-size:7px;padding:1px 4px;
      border-radius:4px;background:rgba(0,0,0,.55);color:rgba(229,231,235,.8);pointer-events:none}
    .match-inputs{display:flex;flex-direction:column;gap:8px}

    .form-actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap;
      margin-top:16px;padding-top:16px;border-top:1px solid var(--border)}
    .form-feedback{font-size:12px;line-height:1.5;padding:6px 10px;border-radius:var(--r3);display:none}
    .form-feedback.error{color:#fca5a5;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2)}
    .form-feedback.ok{color:#6ee7b7;background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2)}
    .form-feedback.info{color:#93c5fd;background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.15)}

    /* FILTER BAR */
    .filter-bar{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:16px}
    .filter-group{display:flex;align-items:center;gap:4px;background:var(--card);
      border:1px solid var(--border);border-radius:var(--r3);padding:4px}
    .filter-btn{padding:5px 12px;border-radius:6px;border:none;background:transparent;
      color:var(--muted2);font-size:12px;font-weight:600;cursor:pointer;transition:all .15s}
    .filter-btn:hover{color:var(--text);background:var(--surface)}
    .filter-btn.active{background:var(--surface2);color:var(--text)}
    .search-box{flex:1;min-width:160px;max-width:280px;padding:7px 12px;border-radius:var(--r3);
      border:1px solid var(--border);background:var(--card);color:var(--text);font-size:13px;outline:none}
    .search-box:focus{border-color:rgba(59,130,246,.4)}
    .sort-select{padding:7px 12px;border-radius:var(--r3);border:1px solid var(--border);
      background:var(--card);color:var(--muted2);font-size:12px;outline:none;cursor:pointer}
    .winner-filter{min-width:140px}
    .winner-filter.has-selection{border-color:rgba(251,191,36,.35);color:var(--gold)}
    .medalist-filter{min-width:140px}
    .medalist-filter.has-selection{border-color:rgba(168,85,247,.45);color:#c4b5fd}

    /* EVENT CARDS */
    .events-list{display:flex;flex-direction:column;gap:14px}
    .event-card{position:relative;border:1px solid var(--border);border-radius:var(--r);
      background:var(--card);backdrop-filter:blur(14px);box-shadow:var(--shadow2);overflow:hidden;
      transition:transform .2s ease,border-color .2s ease,box-shadow .2s ease}
    .event-card:hover{transform:translateY(-2px);border-color:rgba(255,255,255,.14);box-shadow:var(--shadow)}
    .event-card.is-live{border-color:rgba(34,197,94,.22)}
    .event-card.is-live:hover{border-color:rgba(34,197,94,.38);box-shadow:var(--shadow),var(--glow-live)}
    .event-card.is-major{border-color:rgba(251,191,36,.18)}
    .event-card.is-major:hover{border-color:rgba(251,191,36,.35);box-shadow:var(--shadow),var(--glow-gold)}

    .card-bg{position:absolute;inset:0;background-image:var(--ev-bg,none);background-size:cover;
      background-position:center;opacity:.06;filter:blur(12px) saturate(1.5);
      pointer-events:none;z-index:0;transition:opacity .3s}
    .event-card:hover .card-bg{opacity:.1}
    .card-accent{position:absolute;top:0;left:0;right:0;height:2px;
      background:linear-gradient(90deg,transparent,var(--ac,rgba(59,130,246,.7)),transparent);z-index:1}

    .card-inner{position:relative;z-index:2;display:grid;
      grid-template-columns:var(--logo-size) 1fr;gap:16px;padding:18px;align-items:start}
    .logo-box{width:var(--logo-size);height:var(--logo-size);border-radius:14px;
      border:1px solid var(--border2);background:rgba(0,0,0,.2);
      display:grid;place-items:center;overflow:hidden;flex-shrink:0}
    .logo-box img{width:100%;height:100%;object-fit:contain}
    .logo-ph{font-size:28px;opacity:.7}

    .ev-head{display:flex;align-items:flex-start;justify-content:space-between;
      gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .ev-name-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .ev-name{font-family:var(--font-d);font-size:20px;font-weight:700;letter-spacing:-.01em;
      text-transform:uppercase;color:var(--text);text-decoration:none;transition:color .15s}
    .ev-name:hover{color:#93c5fd}

    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;
      font-family:var(--font-m);font-size:10px;letter-spacing:.04em;text-transform:uppercase;
      border:1px solid var(--border2);background:var(--surface);color:var(--muted2);white-space:nowrap}
    .pill.live{border-color:rgba(34,197,94,.3);background:rgba(34,197,94,.1);color:#86efac}
    .pill.live::before{content:"";width:6px;height:6px;border-radius:50%;
      background:var(--live);box-shadow:0 0 8px var(--live);animation:blink 1.5s ease-in-out infinite}
    .pill.finished{border-color:rgba(96,165,250,.2);color:#93c5fd;background:rgba(59,130,246,.07)}
    .pill.major{border-color:rgba(251,191,36,.3);background:rgba(251,191,36,.08);color:#fcd34d}

    .stars-row{display:inline-flex;gap:2px;align-items:center}
    .star{font-size:13px;color:rgba(255,255,255,.18)}
    .star.on{color:var(--gold);filter:drop-shadow(0 0 4px rgba(251,191,36,.5))}

    .ev-meta{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;margin-bottom:12px}
    .meta-kv{border:1px solid var(--border);background:rgba(0,0,0,.2);border-radius:var(--r3);padding:9px 11px}
    .meta-k{font-family:var(--font-m);font-size:9px;letter-spacing:.12em;text-transform:uppercase;
      color:var(--muted);margin-bottom:3px}
    .meta-v{font-size:13px;color:var(--text);line-height:1.3}

    .flag-mini{width:22px;height:14px;border-radius:3px;border:1px solid var(--border2);
      object-fit:fill;vertical-align:-2px;margin-right:5px;display:inline-block}

    .live-block{border:1px solid rgba(34,197,94,.2);background:rgba(34,197,94,.05);
      border-radius:var(--r3);padding:12px;margin-bottom:10px}
    .live-block-head{display:flex;align-items:center;justify-content:space-between;
      gap:8px;margin-bottom:10px;flex-wrap:wrap}
    .live-block-title{font-family:var(--font-d);font-size:13px;font-weight:700;
      letter-spacing:.05em;text-transform:uppercase;color:#86efac}
    .match-list{display:flex;flex-direction:column;gap:6px}
    .match-row{display:flex;align-items:center;gap:10px;padding:8px 10px;
      border-radius:var(--r3);border:1px solid var(--border);background:rgba(0,0,0,.2);font-size:13px}
    .match-row span:last-child{margin-left:auto;color:var(--muted2);font-size:12px}

    .finished-block{border:1px solid rgba(59,130,246,.18);background:rgba(59,130,246,.05);
      border-radius:var(--r3);padding:12px;margin-bottom:10px}
    .winner-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap}
    .winner-label{font-family:var(--font-m);font-size:9px;letter-spacing:.12em;
      text-transform:uppercase;color:var(--muted)}
    .winner-name{font-family:var(--font-d);font-size:18px;font-weight:700;
      letter-spacing:-.01em;text-transform:uppercase;color:var(--gold)}
    .trophy-img{width:24px;height:24px;border-radius:6px;border:1px solid var(--border2);object-fit:contain}
    .runner-up-row{font-size:12px;color:var(--muted2);margin-bottom:10px}
    .runner-up-row strong{color:var(--text)}
    .highlights-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:7px}
    .hl-chip{border:1px solid var(--border);background:rgba(0,0,0,.18);
      border-radius:var(--r3);padding:7px 9px;font-size:12px;color:var(--muted2)}
    .hl-chip strong{color:var(--text);display:block;font-size:10px;font-family:var(--font-m);
      letter-spacing:.08em;text-transform:uppercase;margin-bottom:2px}

    .edit-bar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;
      padding-top:10px;border-top:1px solid var(--border)}

    /* ANALYSIS MODAL */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);
      z-index:100;display:grid;place-items:center;padding:20px;
      opacity:0;pointer-events:none;transition:opacity .25s}
    .modal-overlay.open{opacity:1;pointer-events:all}
    .modal{width:100%;max-width:640px;border:1px solid var(--border2);border-radius:var(--r);
      background:var(--bg2);box-shadow:0 40px 100px rgba(0,0,0,.8);overflow:hidden;
      transform:translateY(20px);transition:transform .25s ease}
    .modal-overlay.open .modal{transform:translateY(0)}
    .modal-header{display:flex;align-items:center;justify-content:space-between;
      padding:16px 20px;border-bottom:1px solid var(--border);background:rgba(255,255,255,.02)}
    .modal-title{font-family:var(--font-d);font-size:18px;font-weight:700;
      text-transform:uppercase;letter-spacing:.04em}
    .modal-body{padding:20px;max-height:70vh;overflow-y:auto}
    .a-section{margin-bottom:16px}
    .a-section-title{font-family:var(--font-m);font-size:10px;letter-spacing:.12em;text-transform:uppercase;
      color:var(--accent);margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid var(--border)}
    .a-item{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;border-radius:var(--r3);
      border:1px solid var(--border);background:var(--surface);margin-bottom:6px;font-size:13px;line-height:1.5}
    .a-icon{font-size:16px;flex-shrink:0;margin-top:1px}
    .a-bar-row{margin-bottom:10px}
    .a-bar-label{display:flex;justify-content:space-between;font-size:12px;color:var(--muted2);margin-bottom:5px}
    .a-bar-label strong{color:var(--text)}
    .a-bar-track{height:6px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
    .a-bar-fill{height:100%;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .8s ease}
    .a-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .a-hl{border:1px solid var(--border);border-radius:var(--r3);padding:12px;background:var(--surface)}
    .a-hl-val{font-family:var(--font-d);font-size:24px;font-weight:700;color:#60a5fa;line-height:1}
    .a-hl-desc{font-size:11px;color:var(--muted);margin-top:4px}

    /* EMPTY */
    .empty-state{text-align:center;padding:60px 20px;border:1px dashed var(--border2);border-radius:var(--r)}
    .empty-icon{font-size:48px;margin-bottom:12px;opacity:.5}
    .empty-title{font-family:var(--font-d);font-size:24px;font-weight:700;
      text-transform:uppercase;color:var(--muted2);margin-bottom:6px}
    .empty-sub{font-size:14px;color:var(--muted)}

    /* BACK + FOOTER */
    .back-btn{position:fixed;left:14px;bottom:14px;z-index:50;
      box-shadow:var(--shadow2);backdrop-filter:blur(10px);font-family:var(--font-m);font-size:11px}
    .page-footer{margin-top:24px;padding-top:16px;border-top:1px solid var(--border);
      display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .footer-text{font-family:var(--font-m);font-size:10px;color:var(--muted);letter-spacing:.04em}
    .footer-text span{padding:2px 6px;border-radius:4px;border:1px solid var(--border2);
      background:rgba(0,0,0,.2);font-family:var(--font-m)}

    /* UTILS */
    .hidden{display:none!important}
    ::-webkit-scrollbar{width:6px}
    ::-webkit-scrollbar-track{background:transparent}
    ::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
    ::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.2)}

    @media(max-width:820px){
      .topbar{flex-direction:column;gap:8px}
      .page-header{flex-direction:column}
      .stats-bar{grid-template-columns:repeat(2,1fr)}
      .form-grid{grid-template-columns:1fr}
      .form-group.span2{grid-column:span 1}
      .card-inner{grid-template-columns:1fr}
      .ev-meta{grid-template-columns:1fr 1fr}
      .highlights-grid{grid-template-columns:1fr 1fr}
      .upload-pair{grid-template-columns:1fr}
    }
    @media(max-width:480px){
      .stats-bar{grid-template-columns:1fr 1fr}
      .ev-meta{grid-template-columns:1fr}
    }
  </style>
</head>
<body>

<!-- Analysis Modal -->
<div class="modal-overlay" id="analysisModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">‚ö° Intelligence Analysis</div>
      <button class="btn ghost" id="closeAnalysis" style="padding:6px 10px;">‚úï</button>
    </div>
    <div class="modal-body" id="analysisContent"></div>
  </div>
</div>

<a class="btn back-btn" href="index.html">‚Üê BACK <span style="opacity:.5;font-size:10px;margin-left:2px;">[0]</span></a>

<div class="wrap">

  <!-- TOPBAR -->
  <nav class="topbar">
    <div class="topbar-left">
      <a class="brand" href="index.html">NEXUS<span>//</span></a>
      <div class="sep"></div>
      <div class="breadcrumb">EVENTS MODULE</div>
    </div>
    <div class="topbar-right">
      <div class="status-chip" id="statusChip" title="Source: file/kz-events-backup.json">
        <div class="s-dot loading" id="statusDot"></div>
        <span id="statusLabel">Loading‚Ä¶</span>
      </div>
      <button class="btn" id="reloadBtn" title="Force re-fetch file/kz-events-backup.json">‚Ü∫ Reload JSON</button>
      <button class="btn" id="exportBtn" title="Ctrl+Shift+S">‚¨á Export</button>
      <button class="btn" id="importBtn" title="Ctrl+Shift+O">‚¨Ü Import</button>
    </div>
  </nav>

  <!-- PAGE HEADER -->
  <div class="page-header">
    <div>
      <div class="page-eyebrow">// Tournament Intelligence</div>
      <h1 class="page-title">Event <span>Registry</span></h1>
      <p class="page-sub">
        Loads from <code>file/kz-events-backup.json</code> on every visit.
        Export after changes and push the file to keep data permanent.
      </p>
    </div>
    <div class="page-actions">
      <button class="btn warn" id="analysisBtn">‚ö° Analyse</button>
      <button class="btn" id="updateBtn">‚úé Update: OFF</button>
      <button class="btn primary" id="toggleAddBtn">Ôºã Add Event</button>
    </div>
  </div>

  <!-- STATS -->
  <div class="stats-bar">
    <div class="stat-card"><div class="stat-label">Total Events</div><div class="stat-value sv-blue" id="statTotal">0</div></div>
    <div class="stat-card"><div class="stat-label">Live Now</div><div class="stat-value sv-green" id="statLive">0</div></div>
    <div class="stat-card"><div class="stat-label">Majors</div><div class="stat-value sv-gold" id="statMajors">0</div></div>
    <div class="stat-card"><div class="stat-label">Total Prize Pool</div><div class="stat-value sv-purple" id="statPrize">‚Äî</div></div>
  </div>

  <!-- ADD / EDIT PANEL -->
  <section class="panel hidden" id="addPanel">
    <div class="panel-header">
      <div class="panel-title" id="panelTitle">Add New Event</div>
      <div class="panel-hint">* required fields</div>
    </div>
    <div class="panel-body">

      <div class="upload-pair">
        <div class="upload-box">
          <input type="file" id="eventLogo" accept="image/*">
          <div class="upload-box-icon">üéØ</div>
          <div class="upload-box-label">Event Logo</div>
          <img class="upload-preview" id="eventLogoPreview">
        </div>
        <div class="upload-box">
          <input type="file" id="trophyLogo" accept="image/*">
          <div class="upload-box-icon">üèÜ</div>
          <div class="upload-box-label">Trophy Logo</div>
          <img class="upload-preview" id="trophyLogoPreview">
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label>Event Name *</label>
          <input id="name" placeholder="e.g. IEM Katowice 2026">
        </div>
        <div class="form-group">
          <label>Google Drive Link *</label>
          <input id="link" placeholder="https://drive.google.com/‚Ä¶">
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="status">
            <option value="Finished">Finished</option>
            <option value="Live">Live</option>
          </select>
        </div>
        <div class="form-group">
          <label>Time / Period</label>
          <input id="time" placeholder="Jan 2026 / 10‚Äì20 Jan 2026 / Live">
        </div>
        <div class="form-group">
          <label>Prize Pool</label>
          <input id="prizePool" placeholder="$1,000,000">
        </div>
        <div class="form-group">
          <label>Teams</label>
          <input id="teams" type="number" min="0" placeholder="16">
        </div>
        <div class="form-group">
          <label>Location</label>
          <div class="location-row">
            <label class="flag-up" for="flagUpload" title="Upload flag image">
              <span class="flag-emoji" id="flagEmoji">üè≥Ô∏è</span>
              <img id="flagPreview" alt="flag" style="display:none;width:100%;height:100%;object-fit:contain;">
              <span class="flag-badge">flag</span>
            </label>
            <input id="location" placeholder="City, Country" style="flex:1;">
          </div>
          <input id="flagUpload" type="file" accept="image/*" class="hidden">
        </div>
        <div class="form-group">
          <label>Importance (1‚Äì5)</label>
          <input id="importance" type="number" min="1" max="5" placeholder="3">
        </div>
        <div class="form-group">
          <label>Major?</label>
          <select id="major">
            <option value="false">No</option>
            <option value="true">Yes</option>
          </select>
        </div>

        <div class="form-group hidden" id="liveOnlyA">
          <label>Stage (Live)</label>
          <input id="stage" placeholder="Playoffs ‚Äî Semifinals">
        </div>
        <div class="form-group span2 hidden" id="liveOnlyB">
          <label>Next Matches (max 3) ‚Äî Team A vs Team B ‚Äì Time</label>
          <div class="match-inputs">
            <input id="m1" placeholder="Natus Vincere vs FaZe ‚Äì Today 18:00">
            <input id="m2" placeholder="Team Spirit vs G2 ‚Äì Today 21:00">
            <input id="m3" placeholder="FURIA vs Cloud9 ‚Äì Tomorrow 15:00">
          </div>
        </div>

        <div class="form-group hidden" id="finishedOnlyA">
          <label>Winner Team</label>
          <input id="winnerTeam" placeholder="Winner team name">
        </div>
        <div class="form-group hidden" id="finishedOnlyA2">
          <label>2nd Place Team</label>
          <input id="runnerUpTeam" placeholder="Runner-up name">
        </div>
        <div class="form-group hidden" id="finishedOnlyB">
          <label>MVP / EVP / VP</label>
          <div class="match-inputs">
            <input id="mvp" placeholder="MVP player">
            <input id="evp" placeholder="EVP player">
            <input id="vp"  placeholder="VP player">
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button class="btn success" id="submitBtn">Ôºã Add Event</button>
        <button class="btn hidden" id="cancelEditBtn">‚úï Cancel</button>
        <button class="btn ghost" id="clearAllBtn">Clear Form</button>
        <div class="form-feedback" id="formFeedback"></div>
      </div>
    </div>
  </section>

  <!-- FILTERS -->
  <div class="filter-bar">
    <div class="filter-group">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="Live">Live</button>
      <button class="filter-btn" data-filter="Finished">Finished</button>
      <button class="filter-btn" data-filter="major">Majors</button>
    </div>
    <select class="sort-select winner-filter" id="winnerFilter" title="Filter by winner">
      <option value="">üèÜ All Winners</option>
    </select>
    <select class="sort-select medalist-filter" id="medalistFilter" title="Filter by medalist">
      <option value="">üéñÔ∏è All Medalists</option>
    </select>
    <input class="search-box" id="searchBox" placeholder="Search events‚Ä¶" autocomplete="off">
    <select class="sort-select" id="sortSelect">
      <option value="newest">Newest first</option>
      <option value="oldest">Oldest first</option>
      <option value="importance">By importance</option>
      <option value="az">A ‚Üí Z</option>
    </select>
  </div>

  <!-- LIST -->
  <div class="events-list" id="eventsList"></div>

  <!-- FOOTER -->
  <div class="page-footer">
    <div class="footer-text">
      Source: <span>file/kz-events-backup.json</span> &nbsp;¬∑&nbsp; Cache: <span>localStorage</span>
    </div>
    <div class="footer-text">
      <span>Ctrl+Shift+A</span> Panel &nbsp;¬∑&nbsp;
      <span>Ctrl+Shift+S</span> Export &nbsp;¬∑&nbsp;
      <span>Ctrl+Shift+O</span> Import &nbsp;¬∑&nbsp;
      <span>0</span> Back
    </div>
  </div>

</div><!-- /wrap -->

<script>
  // ‚îÄ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const JSON_PATH   = "file/kz-events-backup.json";
  const STORAGE_KEY = "kz_events_v2";

  // ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let events       = [];
  let updateMode   = false;
  let editingIndex = null;
  let filterStatus = "all";
  let filterWinner = "";
  let filterMedalist = "";
  let searchQuery  = "";
  let sortMode     = "newest";

  // ‚îÄ‚îÄ‚îÄ DOM HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const g  = id => document.getElementById(id);
  const st = v  => (v ?? "").toString();

  // ‚îÄ‚îÄ‚îÄ PERSISTENCE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function loadLocal() {
    try {
      const d = JSON.parse(localStorage.getItem(STORAGE_KEY));
      return Array.isArray(d) ? d : [];
    } catch { return []; }
  }

  function saveLocal() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
  }

  // ‚îÄ‚îÄ‚îÄ STATUS CHIP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function setStatus(state, text) {
    g("statusDot").className   = "s-dot " + state;   // ok | loading | err | (empty)
    g("statusLabel").textContent = text;
  }

  // ‚îÄ‚îÄ‚îÄ FETCH JSON FILE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function fetchJSON() {
    setStatus("loading", "Loading‚Ä¶");
    try {
      const res  = await fetch(JSON_PATH + "?_=" + Date.now());
      if (!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();
      if (!Array.isArray(data)) throw new Error("Not a valid array");
      events = data;
      saveLocal();
      setStatus("ok", "JSON loaded");
      return true;
    } catch (err) {
      setStatus("err", "File not found");
      console.info("[Events] " + JSON_PATH + " ‚Äî", err.message);
      return false;
    }
  }

  // ‚îÄ‚îÄ‚îÄ EXPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function exportJSON() {
    const blob = new Blob([JSON.stringify(events, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "kz-events-backup.json";
    a.click();
    URL.revokeObjectURL(a.href);
    showFeedback("‚úì Exported kz-events-backup.json ‚Äî place it in file/ and push to GitHub.", "ok");
  }

  // ‚îÄ‚îÄ‚îÄ IMPORT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function openImport() {
    const inp = document.createElement("input");
    inp.type = "file"; inp.accept = "application/json";
    inp.onchange = () => {
      const f = inp.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          if (!Array.isArray(data)) throw new Error("invalid");
          events = data;
          saveLocal();
          updateStats(); render();
          showFeedback("‚úì Imported. Export and push to file/ to make it permanent.", "ok");
          setStatus("ok", "Imported");
        } catch { showFeedback("Import failed: invalid JSON file.", "error"); }
      };
      reader.readAsText(f);
    };
    inp.click();
  }

  // ‚îÄ‚îÄ‚îÄ FORM FEEDBACK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showFeedback(msg, type) {
    const el = g("formFeedback");
    el.textContent   = msg || "";
    el.className     = "form-feedback" + (type ? " " + type : "");
    el.style.display = msg ? "" : "none";
  }

  // ‚îÄ‚îÄ‚îÄ STATUS FIELDS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function toggleStatusFields() {
    const live = g("status").value === "Live";
    ["liveOnlyA","liveOnlyB"].forEach(id => g(id).classList.toggle("hidden", !live));
    ["finishedOnlyA","finishedOnlyA2","finishedOnlyB"].forEach(id => g(id).classList.toggle("hidden", live));
  }

  // ‚îÄ‚îÄ‚îÄ FLAG / LOGO PREVIEWS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function setFlagPreview(url) {
    const img = g("flagPreview"), em = g("flagEmoji");
    if (url) { img.src = url; img.style.display = "block"; em.style.display = "none"; }
    else     { img.style.display = "none"; img.removeAttribute("src"); em.style.display = ""; }
  }

  async function previewFile(inputId, previewId) {
    const file = g(inputId).files[0];
    const prev = g(previewId);
    if (file) {
      const url = await fileToDataURL(file);
      prev.src = url; prev.style.display = "block";
    } else {
      prev.style.display = "none";
    }
  }

  g("eventLogo").addEventListener("change",  () => previewFile("eventLogo",  "eventLogoPreview"));
  g("trophyLogo").addEventListener("change", () => previewFile("trophyLogo", "trophyLogoPreview"));
  g("flagUpload").addEventListener("change", async () => {
    setFlagPreview(await fileToDataURL(g("flagUpload").files[0]));
  });

  // ‚îÄ‚îÄ‚îÄ UTILITIES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function isTyping(t) {
    if (!t) return false;
    return ["input","textarea","select"].includes((t.tagName||"").toLowerCase()) || t.isContentEditable;
  }

  function fileToDataURL(file) {
    return new Promise(resolve => {
      if (!file) return resolve("");
      const r = new FileReader();
      r.onload = () => resolve(r.result || "");
      r.onerror = () => resolve("");
      r.readAsDataURL(file);
    });
  }

  function starsHTML(n) {
    const v = Math.max(0, Math.min(5, Number(n) || 0));
    return `<span class="stars-row">${Array.from({length:5},(_,i) =>
      `<span class="star${i<v?" on":""}"">‚òÖ</span>`).join("")}</span>`;
  }

  // ‚îÄ‚îÄ‚îÄ CLEAR / MODES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function clearForm() {
    ["name","link","time","prizePool","teams","location","importance",
     "stage","m1","m2","m3","winnerTeam","runnerUpTeam","mvp","evp","vp"]
      .forEach(id => g(id).value = "");
    g("status").value = "Finished";
    g("major").value  = "false";
    ["flagUpload","eventLogo","trophyLogo"].forEach(id => g(id).value = "");
    g("eventLogoPreview").style.display  = "none";
    g("trophyLogoPreview").style.display = "none";
    setFlagPreview("");
    showFeedback("");
    toggleStatusFields();
  }

  function enterAddMode() {
    editingIndex = null;
    g("panelTitle").textContent = "Add New Event";
    g("submitBtn").textContent  = "Ôºã Add Event";
    g("cancelEditBtn").classList.add("hidden");
    showFeedback("");
    clearForm();
  }

  function enterEditMode(idx) {
    const ev = events[idx];
    editingIndex = idx;
    g("panelTitle").textContent = "Update Event";
    g("submitBtn").textContent  = "‚úì Save Update";
    g("cancelEditBtn").classList.remove("hidden");

    g("name").value         = st(ev.name);
    g("link").value         = st(ev.driveLink);
    g("status").value       = st(ev.status || "Finished");
    g("time").value         = st(ev.time);
    g("prizePool").value    = st(ev.prizePool);
    g("teams").value        = st(ev.teams);
    g("location").value     = st(ev.location);
    g("importance").value   = st(ev.importance);
    g("major").value        = ev.major ? "true" : "false";
    g("stage").value        = st(ev.stage);
    g("m1").value = st((ev.nextMatches||[])[0]||"");
    g("m2").value = st((ev.nextMatches||[])[1]||"");
    g("m3").value = st((ev.nextMatches||[])[2]||"");
    g("winnerTeam").value   = st(ev.winnerTeam);
    g("runnerUpTeam").value = st(ev.runnerUpTeam);
    g("mvp").value = st(ev.mvp);
    g("evp").value = st(ev.evp);
    g("vp").value  = st(ev.vp);

    setFlagPreview(ev.flagImage || "");
    toggleStatusFields();
    showFeedback("Upload new logo/flag only if you want to replace the current one.", "info");
    g("addPanel").classList.remove("hidden");
    g("toggleAddBtn").classList.add("primary");
  }

  // ‚îÄ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function handleSubmit() {
    const name = g("name").value.trim();
    const link = g("link").value.trim();
    if (!name)                                return showFeedback("Event name is required.", "error");
    if (!link || !/^https?:\/\//i.test(link)) return showFeedback("A valid https link is required.", "error");

    const isLive        = g("status").value === "Live";
    const newEventLogo  = await fileToDataURL(g("eventLogo").files[0]);
    const newTrophyLogo = await fileToDataURL(g("trophyLogo").files[0]);
    const newFlagImage  = await fileToDataURL(g("flagUpload").files[0]);
    const nextMatches   = [g("m1").value.trim(), g("m2").value.trim(), g("m3").value.trim()]
                            .filter(Boolean).slice(0,3);

    const payload = {
      eventLogo:    newEventLogo,
      trophyLogo:   newTrophyLogo,
      flagImage:    newFlagImage,
      name,
      driveLink:    link,
      status:       g("status").value,
      time:         g("time").value.trim() || (isLive ? "Live" : ""),
      prizePool:    g("prizePool").value.trim(),
      teams:        Number(g("teams").value) || 0,
      location:     g("location").value.trim(),
      importance:   Math.max(1, Math.min(5, Number(g("importance").value) || 1)),
      major:        g("major").value === "true",
      stage:        isLive ? g("stage").value.trim() : "",
      nextMatches:  isLive ? nextMatches : [],
      winnerTeam:   isLive ? "" : g("winnerTeam").value.trim(),
      runnerUpTeam: isLive ? "" : g("runnerUpTeam").value.trim(),
      mvp:          isLive ? "" : g("mvp").value.trim(),
      evp:          isLive ? "" : g("evp").value.trim(),
      vp:           isLive ? "" : g("vp").value.trim(),
      addedAt:      editingIndex === null
                      ? Date.now()
                      : (events[editingIndex].addedAt || Date.now()),
    };

    if (editingIndex === null) {
      events.unshift(payload);
    } else {
      const old = events[editingIndex];
      payload.eventLogo  = payload.eventLogo  || old.eventLogo  || "";
      payload.trophyLogo = payload.trophyLogo || old.trophyLogo || "";
      payload.flagImage  = payload.flagImage  || old.flagImage  || "";
      events[editingIndex] = payload;
    }

    saveLocal();
    updateStats();
    render();
    showFeedback("‚úì Saved locally. Export the JSON and push to file/ to persist permanently.", "ok");
    if (editingIndex === null) clearForm();
  }

  // ‚îÄ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function deleteEvent(idx) {
    if (!confirm("Delete this event?")) return;
    events.splice(idx, 1);
    if (editingIndex === idx) enterAddMode();
    saveLocal();
    updateStats();
    render();
  }

  // ‚îÄ‚îÄ‚îÄ STATS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function parsePrize(s) {
    if (!s) return 0;
    const n = parseFloat(s.replace(/[^0-9.]/g, ""));
    if (isNaN(n)) return 0;
    const l = s.toLowerCase();
    if (l.includes("m")) return n * 1e6;
    if (l.includes("k")) return n * 1e3;
    return n;
  }

  function updateStats() {
    g("statTotal").textContent  = events.length;
    g("statLive").textContent   = events.filter(e => e.status === "Live").length;
    g("statMajors").textContent = events.filter(e => e.major).length;
    const tp = events.reduce((a,e) => a + parsePrize(e.prizePool), 0);
    g("statPrize").textContent  = tp === 0 ? "‚Äî"
      : tp >= 1e6 ? "$" + (tp/1e6).toFixed(1) + "M"
      : tp >= 1e3 ? "$" + (tp/1e3).toFixed(0) + "K"
      : "$" + tp.toFixed(0);
    updateWinnerFilter();
    updateMedalistFilter();
  }

  // ‚îÄ‚îÄ‚îÄ ANALYSIS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function openAnalysis() {
    if (!events.length) { alert("No events to analyze yet."); return; }

    const total      = events.length;
    const live       = events.filter(e => e.status === "Live").length;
    const majors     = events.filter(e => e.major).length;
    const avgImp     = (events.reduce((a,e) => a + (Number(e.importance)||0), 0) / total).toFixed(1);
    const tp         = events.reduce((a,e) => a + parsePrize(e.prizePool), 0);
    const totalTeams = events.reduce((a,e) => a + (Number(e.teams)||0), 0);

    const tally = (key) => events.reduce((m,e) => {
      if (e[key]) m[e[key]] = (m[e[key]]||0) + 1;
      return m;
    }, {});
    const top = (obj, n) => Object.entries(obj).sort((a,b)=>b[1]-a[1]).slice(0,n);

    const winners = top(tally("winnerTeam"), 5);
    const mvps    = top(tally("mvp"), 5);
    const locMap  = {};
    events.filter(e => e.location).forEach(e => {
      const k = e.location.split(",").pop()?.trim() || e.location;
      locMap[k] = (locMap[k]||0) + 1;
    });
    const topLoc  = top(locMap, 1)[0];
    const richest = events.filter(e => parsePrize(e.prizePool) > 0)
                          .sort((a,b) => parsePrize(b.prizePool) - parsePrize(a.prizePool))[0];
    const maxW    = winners.length ? winners[0][1] : 1;

    const notes = [];
    if (live)    notes.push({ i:"üî¥", t:`${live} event${live>1?"s":""} currently live.` });
    if (majors)  notes.push({ i:"üëë", t:`${majors} Major${majors>1?"s":""} = ${((majors/total)*100).toFixed(0)}% of all events.` });
    if (+avgImp >= 4)     notes.push({ i:"‚≠ê", t:`High-tier focus ‚Äî avg importance ${avgImp}/5.` });
    else if (+avgImp <= 2) notes.push({ i:"üìâ", t:`Low avg importance (${avgImp}/5) ‚Äî consider adding bigger events.` });
    else                   notes.push({ i:"üìä", t:`Balanced registry ‚Äî avg importance ${avgImp}/5.` });
    if (winners.length && winners[0][1] > 1)
      notes.push({ i:"ü•á", t:`${winners[0][0]} leads with ${winners[0][1]} wins tracked.` });
    if (tp > 0)  notes.push({ i:"üí∞", t:`Total prize pool on record: $${(tp/1e6).toFixed(2)}M.` });
    if (topLoc)  notes.push({ i:"üìç", t:`Most hosted region: ${topLoc[0]} (${topLoc[1]} event${topLoc[1]>1?"s":""}).` });
    if (richest) notes.push({ i:"üéØ", t:`Richest event: ${richest.name} ‚Äî ${richest.prizePool}.` });

    g("analysisContent").innerHTML = `
      <div class="a-section">
        <div class="a-section-title">Overview</div>
        <div class="a-grid">
          <div class="a-hl"><div class="a-hl-val">${total}</div><div class="a-hl-desc">Total events</div></div>
          <div class="a-hl"><div class="a-hl-val" style="color:#34d399">${live}</div><div class="a-hl-desc">Currently live</div></div>
          <div class="a-hl"><div class="a-hl-val" style="color:#fbbf24">${majors}</div><div class="a-hl-desc">Major events</div></div>
          <div class="a-hl"><div class="a-hl-val" style="color:#a78bfa">${totalTeams}</div><div class="a-hl-desc">Teams (total slots)</div></div>
        </div>
      </div>
      ${winners.length ? `
      <div class="a-section">
        <div class="a-section-title">üèÜ Top Winners</div>
        ${winners.map(([t,w]) => `
          <div class="a-bar-row">
            <div class="a-bar-label"><strong>${t}</strong><span>${w} win${w>1?"s":""}</span></div>
            <div class="a-bar-track"><div class="a-bar-fill" style="width:${Math.round(w/maxW*100)}%"></div></div>
          </div>`).join("")}
      </div>` : ""}
      ${mvps.length ? `
      <div class="a-section">
        <div class="a-section-title">‚≠ê Top MVPs</div>
        ${mvps.map(([p,c]) => `
          <div class="a-item">
            <span class="a-icon">üéÆ</span>
            <span><strong>${p}</strong> ‚Äî MVP in ${c} event${c>1?"s":""}</span>
          </div>`).join("")}
      </div>` : ""}
      <div class="a-section">
        <div class="a-section-title">üß† Intelligence Notes</div>
        ${notes.map(n => `
          <div class="a-item"><span class="a-icon">${n.i}</span><span>${n.t}</span></div>`).join("")}
      </div>`;

    g("analysisModal").classList.add("open");
  }

  // ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function getFiltered() {
    let list = [...events];
    if (filterStatus === "major")        list = list.filter(e => e.major);
    else if (filterStatus !== "all")     list = list.filter(e => e.status === filterStatus);
    if (filterWinner) {
      list = list.filter(e => (e.winnerTeam||"").toLowerCase() === filterWinner.toLowerCase());
    }
    if (filterMedalist) {
      const m = filterMedalist.toLowerCase();
      list = list.filter(e => 
        (e.mvp||"").toLowerCase() === m || 
        (e.evp||"").toLowerCase() === m || 
        (e.vp||"").toLowerCase() === m
      );
    }
    if (searchQuery) {
      const q = searchQuery.toLowerCase();
      list = list.filter(e => [e.name, e.location, e.winnerTeam, e.mvp]
        .some(v => (v||"").toLowerCase().includes(q)));
    }
    if (sortMode === "oldest")           list.sort((a,b) => (a.addedAt||0) - (b.addedAt||0));
    else if (sortMode === "importance")  list.sort((a,b) => (b.importance||0) - (a.importance||0));
    else if (sortMode === "az")          list.sort((a,b) => (a.name||"").localeCompare(b.name||""));
    else                                 list.sort((a,b) => (b.addedAt||0) - (a.addedAt||0));
    return list;
  }

  function render() {
    const listEl = g("eventsList");
    listEl.innerHTML = "";
    const list   = getFiltered();
    const idxMap = new Map(events.map((ev,i) => [ev,i]));

    if (!list.length) {
      listEl.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">üì≠</div>
          <div class="empty-title">${events.length === 0 ? "No Events Yet" : "No Results"}</div>
          <div class="empty-sub">${events.length === 0
            ? "Add an event above or place kz-events-backup.json in file/ and reload."
            : "Try adjusting your search or filters."}</div>
        </div>`;
      return;
    }

    list.forEach(ev => {
      const idx    = idxMap.get(ev);
      const isLive = ev.status === "Live";
      const ac     = ev.major ? "rgba(251,191,36,.7)" : isLive ? "rgba(34,197,94,.7)" : "rgba(59,130,246,.5)";

      const card   = document.createElement("article");
      card.className = `event-card${isLive?" is-live":""}${ev.major?" is-major":""}`;

      const locText = st(ev.location) || "‚Äî";
      const locHTML = ev.flagImage
        ? `<img class="flag-mini" src="${ev.flagImage}" alt="flag">${locText}`
        : locText;

      const liveBlock = isLive ? `
        <div class="live-block">
          <div class="live-block-head">
            <div class="live-block-title">Live Details</div>
            <span class="pill live">Stage: ${st(ev.stage)||"‚Äî"}</span>
          </div>
          <div class="match-list">
            ${(ev.nextMatches||[]).slice(0,3).map(m => {
              const p = st(m).split(" ‚Äì ");
              return `<div class="match-row"><span>${p[0]||st(m)}</span><span>${p.slice(1).join(" ‚Äì ")}</span></div>`;
            }).join("") || `<div style="font-size:12px;color:var(--muted);padding:4px 0;">No matches scheduled.</div>`}
          </div>
        </div>` : "";

      const finishedBlock = !isLive ? `
        <div class="finished-block">
          <div class="winner-row">
            <span class="winner-label">Winner</span>
            <span class="winner-name">${st(ev.winnerTeam)||"‚Äî"}</span>
            ${ev.trophyLogo && ev.winnerTeam ? `<img class="trophy-img" src="${ev.trophyLogo}" alt="trophy">` : ""}
          </div>
          <div class="runner-up-row"><strong>2nd place:</strong> ${st(ev.runnerUpTeam)||"‚Äî"}</div>
          <div class="highlights-grid">
            <div class="hl-chip"><strong>MVP</strong>${st(ev.mvp)||"‚Äî"}</div>
            <div class="hl-chip"><strong>EVP</strong>${st(ev.evp)||"‚Äî"}</div>
            <div class="hl-chip"><strong>VP</strong>${st(ev.vp)||"‚Äî"}</div>
          </div>
        </div>` : "";

      const editBar = updateMode ? `
        <div class="edit-bar">
          <button class="btn primary" data-action="edit"   data-idx="${idx}">‚úé Edit</button>
          <button class="btn danger"  data-action="delete" data-idx="${idx}">‚úï Delete</button>
        </div>` : "";

      card.innerHTML = `
        <div class="card-bg" style="background-image:url('${ev.eventLogo||""}')"></div>
        <div class="card-accent" style="--ac:${ac}"></div>
        <div class="card-inner">
          <div class="logo-box">${ev.eventLogo ? `<img src="${ev.eventLogo}" alt="${st(ev.name)}">` : `<div class="logo-ph">üìÖ</div>`}</div>
          <div>
            <div class="ev-head">
              <div class="ev-name-row">
                <a class="ev-name" href="${st(ev.driveLink)}" target="_blank" rel="noopener">${st(ev.name)}</a>
                ${isLive ? `<span class="pill live">Live</span>` : ev.time ? `<span class="pill finished">${st(ev.time)}</span>` : ""}
                ${ev.major ? `<span class="pill major">üëë Major</span>` : ""}
              </div>
              ${starsHTML(ev.importance)}
            </div>
            <div class="ev-meta">
              <div class="meta-kv"><div class="meta-k">Prize Pool</div><div class="meta-v">${st(ev.prizePool)||"‚Äî"}</div></div>
              <div class="meta-kv"><div class="meta-k">Teams</div><div class="meta-v">${st(ev.teams)||"0"}</div></div>
              <div class="meta-kv"><div class="meta-k">Location</div><div class="meta-v">${locHTML}</div></div>
            </div>
            ${liveBlock}${finishedBlock}${editBar}
          </div>
        </div>`;

      listEl.appendChild(card);
    });

    // Delegate click events for edit/delete
    listEl.querySelectorAll("button[data-action]").forEach(btn => {
      btn.addEventListener("click", () => {
        const idx = Number(btn.dataset.idx);
        if (btn.dataset.action === "edit")   enterEditMode(idx);
        if (btn.dataset.action === "delete") deleteEvent(idx);
      });
    });
  }

  // ‚îÄ‚îÄ‚îÄ WIRE CONTROLS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  g("status").addEventListener("change", toggleStatusFields);
  g("submitBtn").addEventListener("click", handleSubmit);
  g("cancelEditBtn").addEventListener("click", () => enterAddMode());
  g("clearAllBtn").addEventListener("click",   () => clearForm());

  g("updateBtn").addEventListener("click", () => {
    updateMode = !updateMode;
    g("updateBtn").textContent = `‚úé Update: ${updateMode ? "ON" : "OFF"}`;
    g("updateBtn").classList.toggle("active-on", updateMode);
    if (!updateMode) enterAddMode();
    render();
  });

  g("toggleAddBtn").addEventListener("click", () => {
    const panel = g("addPanel");
    panel.classList.toggle("hidden");
    g("toggleAddBtn").classList.toggle("primary", !panel.classList.contains("hidden"));
  });

  g("analysisBtn").addEventListener("click", openAnalysis);
  g("closeAnalysis").addEventListener("click", () => g("analysisModal").classList.remove("open"));
  g("analysisModal").addEventListener("click", e => {
    if (e.target === g("analysisModal")) g("analysisModal").classList.remove("open");
  });

  g("exportBtn").addEventListener("click", exportJSON);
  g("importBtn").addEventListener("click", openImport);

  // RELOAD JSON ‚Äî manual force fetch
  g("reloadBtn").addEventListener("click", async () => {
    const ok = await fetchJSON();
    if (ok) {
      updateStats(); render();
      showFeedback("‚úì JSON reloaded from file/kz-events-backup.json.", "ok");
    } else {
      showFeedback("Could not load file/kz-events-backup.json ‚Äî make sure the file exists in the file/ folder and is pushed to GitHub.", "error");
    }
  });

  document.querySelectorAll(".filter-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      filterStatus = btn.dataset.filter;
      render();
    });
  });

  g("searchBox").addEventListener("input",   e => { searchQuery = e.target.value.trim(); render(); });
  g("sortSelect").addEventListener("change", e => { sortMode = e.target.value; render(); });
  g("winnerFilter").addEventListener("change", e => { 
    filterWinner = e.target.value; 
    e.target.classList.toggle("has-selection", filterWinner !== "");
    render(); 
  });
  g("medalistFilter").addEventListener("change", e => { 
    filterMedalist = e.target.value; 
    e.target.classList.toggle("has-selection", filterMedalist !== "");
    render(); 
  });

  // ‚îÄ‚îÄ‚îÄ UPDATE WINNER FILTER DROPDOWN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function updateWinnerFilter() {
    const select = g("winnerFilter");
    const currentValue = select.value;
    
    // Get unique winners (non-empty) sorted alphabetically
    const winners = [...new Set(
      events
        .map(e => (e.winnerTeam || "").trim())
        .filter(w => w.length > 0)
    )].sort((a, b) => a.localeCompare(b));
    
    // Rebuild options
    select.innerHTML = '<option value="">üèÜ All Winners</option>';
    winners.forEach(w => {
      const opt = document.createElement("option");
      opt.value = w;
      opt.textContent = w;
      select.appendChild(opt);
    });
    
    // Restore selection if still valid
    if (winners.includes(currentValue)) {
      select.value = currentValue;
    } else {
      select.value = "";
      filterWinner = "";
    }
    
    // Toggle highlight class
    select.classList.toggle("has-selection", select.value !== "");
  }

  // ‚îÄ‚îÄ‚îÄ UPDATE MEDALIST FILTER DROPDOWN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function updateMedalistFilter() {
    const select = g("medalistFilter");
    const currentValue = select.value;
    
    // Get unique medalists from MVP, EVP, VP (non-empty) sorted alphabetically
    const medalists = [...new Set(
      events
        .flatMap(e => [
          (e.mvp || "").trim(),
          (e.evp || "").trim(),
          (e.vp || "").trim()
        ])
        .filter(m => m.length > 0)
    )].sort((a, b) => a.localeCompare(b));
    
    // Rebuild options
    select.innerHTML = '<option value="">üéñÔ∏è All Medalists</option>';
    medalists.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m;
      opt.textContent = m;
      select.appendChild(opt);
    });
    
    // Restore selection if still valid
    if (medalists.includes(currentValue)) {
      select.value = currentValue;
    } else {
      select.value = "";
      filterMedalist = "";
    }
    
    // Toggle highlight class
    select.classList.toggle("has-selection", select.value !== "");
  }

  document.addEventListener("keydown", e => {
    if (e.ctrlKey && e.shiftKey && ["a","A"].includes(e.key)) { e.preventDefault(); g("toggleAddBtn").click(); }
    if (e.ctrlKey && e.shiftKey && ["s","S"].includes(e.key)) { e.preventDefault(); exportJSON(); }
    if (e.ctrlKey && e.shiftKey && ["o","O"].includes(e.key)) { e.preventDefault(); openImport(); }
    if (e.key === "Escape") g("analysisModal").classList.remove("open");
    if (e.key === "0" && !isTyping(e.target)) window.location.href = "index.html";
  });

  // ‚îÄ‚îÄ‚îÄ BOOT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function boot() {
    // Step 1: render immediately from localStorage cache (no visual flash)
    events = loadLocal();
    toggleStatusFields();
    enterAddMode();
    updateStats();
    render();

    // Step 2: fetch the canonical JSON file (source of truth)
    const ok = await fetchJSON();
    if (ok) {
      updateStats();
      render();
    }
    // If fetchJSON fails: stays on localStorage cache, status chip shows error
  }

  boot();
</script>
</body>
</html>
