<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#070d1a" />
  <title>NEXUS // Events & Match Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&family=Space+Mono:wght@400;700&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GLOBAL DESIGN TOKENS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --bg:#070d1a; --bg1:#0a1020; --bg2:#0d1525;
      --card:rgba(14,26,47,.92); --card2:rgba(10,15,35,.95);
      --surface:rgba(255,255,255,.04); --surface2:rgba(255,255,255,.07);
      --border:rgba(0,212,255,.12); --border2:rgba(0,212,255,.2);
      --border-w:rgba(255,255,255,.08);
      --text:#d4e0ff; --muted:#6a7fa8; --muted2:#a0b8d8;
      --accent:#00d4ff; --accent2:#7cf2c2;
      --ev-accent:#3b82f6; --ev-accent2:#06b6d4;
      --ok:#10b981; --warn:#f59e0b; --danger:#ef4444; --live:#22c55e; --gold:#fbbf24;
      --hot:#ff4d6d; --wine:#9b2335;
      --r:16px; --r2:12px; --r3:10px;
      --shadow:0 24px 64px rgba(0,0,0,.6); --shadow2:0 8px 32px rgba(0,0,0,.4);
      --glow:rgba(0,212,255,.15); --glow-live:0 0 20px rgba(34,197,94,.3); --glow-gold:0 0 20px rgba(251,191,36,.25);
      --font-d:'Rajdhani',sans-serif;
      --font-m:'Share Tech Mono','Space Mono',monospace;
      --font-b:'DM Sans','Exo 2',sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:var(--font-b);color:var(--text);background:var(--bg);
      overflow-x:hidden;min-height:100vh;position:relative;
    }
    body::before{
      content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
      background-image:
        linear-gradient(rgba(0,212,255,.025) 1px,transparent 1px),
        linear-gradient(90deg,rgba(0,212,255,.025) 1px,transparent 1px);
      background-size:40px 40px;
    }
    body::after{
      content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
      background:
        radial-gradient(ellipse 1000px 600px at 0% 0%,rgba(0,212,255,.07) 0%,transparent 60%),
        radial-gradient(ellipse 800px 600px at 100% 10%,rgba(6,182,212,.06) 0%,transparent 55%),
        radial-gradient(ellipse 600px 400px at 50% 100%,rgba(139,92,246,.05) 0%,transparent 50%);
    }

    /* â”€â”€ SCANLINE â”€â”€ */
    .scanline{
      position:fixed;top:0;left:0;right:0;height:2px;pointer-events:none;z-index:999;opacity:.4;
      background:linear-gradient(90deg,transparent,rgba(0,212,255,.3),transparent);
      animation:scanline 8s linear infinite;
    }
    @keyframes scanline{0%{transform:translateY(-100%)}100%{transform:translateY(100vh)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
    @keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
    @keyframes flicker{0%,100%{opacity:1}92%{opacity:1}93%{opacity:.7}94%{opacity:1}97%{opacity:.85}98%{opacity:1}}
    @keyframes gridFade{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
    @keyframes slideIn{from{opacity:0;transform:translateX(-16px)}to{opacity:1;transform:translateX(0)}}
    @keyframes matchReveal{from{opacity:0;transform:scaleX(.97)}to{opacity:1;transform:scaleX(1)}}
    @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOP NAV
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .topnav{
      position:sticky;top:0;z-index:100;
      display:flex;align-items:center;gap:14px;flex-wrap:wrap;
      padding:13px 24px;
      background:rgba(7,13,26,.92);
      border-bottom:1px solid var(--border2);
      backdrop-filter:blur(14px);
    }
    .topnav::after{
      content:'';position:absolute;bottom:0;left:0;right:0;height:1px;
      background:linear-gradient(90deg,transparent,var(--accent),transparent);opacity:.4;
    }
    .brand{
      display:flex;align-items:center;gap:10px;text-decoration:none;flex-shrink:0;
    }
    .brand-icon{
      width:34px;height:34px;border-radius:8px;border:1px solid rgba(0,212,255,.4);
      background:rgba(0,212,255,.08);display:flex;align-items:center;justify-content:center;
      font-size:15px;color:var(--accent);animation:flicker 10s infinite;
      position:relative;
    }
    .brand-icon::before{content:'';position:absolute;inset:2px;border:1px solid rgba(0,212,255,.2);border-radius:5px;}
    .brand-name{font-family:var(--font-d);font-size:19px;font-weight:700;letter-spacing:3px;color:var(--accent);text-transform:uppercase;line-height:1;}
    .brand-sub{font-family:var(--font-m);font-size:9px;color:var(--muted);letter-spacing:1px;margin-top:1px;}

    .nav-sep{width:1px;height:28px;background:var(--border2);flex-shrink:0;}

    /* â”€â”€ TAB PILLS â”€â”€ */
    .tab-pills{display:flex;gap:4px;background:rgba(0,0,0,.25);border:1px solid var(--border);border-radius:10px;padding:4px;}
    .tab-pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:7px 14px;border-radius:7px;border:none;cursor:pointer;
      font-family:var(--font-d);font-size:13px;font-weight:600;letter-spacing:1px;text-transform:uppercase;
      color:var(--muted);background:transparent;transition:all .2s;white-space:nowrap;
    }
    .tab-pill:hover{color:var(--text);background:rgba(0,212,255,.06);}
    .tab-pill.active{
      background:linear-gradient(135deg,rgba(0,212,255,.18),rgba(124,242,194,.1));
      border:1px solid rgba(0,212,255,.4);color:var(--accent);
      box-shadow:0 0 16px rgba(0,212,255,.12);
    }

    /* â”€â”€ STATUS CHIPS â”€â”€ */
    .status-chip{
      display:inline-flex;align-items:center;gap:7px;padding:5px 11px;
      border-radius:999px;border:1px solid var(--border2);background:var(--surface);
      font-family:var(--font-m);font-size:10px;letter-spacing:.04em;cursor:default;user-select:none;white-space:nowrap;
    }
    .s-dot{width:7px;height:7px;border-radius:50%;background:var(--muted);transition:background .3s,box-shadow .3s;}
    .s-dot.ok{background:var(--ok);box-shadow:0 0 8px rgba(16,185,129,.5);}
    .s-dot.loading{background:var(--warn);box-shadow:0 0 8px rgba(245,158,11,.4);animation:blink 1s ease-in-out infinite;}
    .s-dot.err{background:var(--danger);}
    .status-dot-sd{width:6px;height:6px;border-radius:50%;background:var(--accent2);animation:pulse 2s infinite;}
    .status-dot-sd.red{background:var(--hot);animation:pulse 1.5s infinite;}

    /* â”€â”€ NAV BUTTONS â”€â”€ */
    .topnav-right{display:flex;align-items:center;gap:8px;margin-left:auto;flex-wrap:wrap;}
    .ev-controls{display:flex;gap:6px;align-items:center;}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SHARED BUTTON
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn{
      display:inline-flex;align-items:center;gap:7px;padding:8px 14px;
      border-radius:var(--r3);border:1px solid var(--border);background:rgba(0,212,255,.06);
      color:var(--text);font-family:var(--font-b);font-size:13px;font-weight:600;
      cursor:pointer;outline:none;text-decoration:none;
      transition:all .18s ease;white-space:nowrap;user-select:none;
    }
    .btn:hover{border-color:rgba(0,212,255,.4);background:rgba(0,212,255,.12);transform:translateY(-1px);}
    .btn:active{transform:translateY(0);}
    .btn:focus-visible{box-shadow:0 0 0 3px rgba(0,212,255,.3);}
    .btn:disabled{opacity:.4;cursor:not-allowed;pointer-events:none;}
    .btn.primary{background:linear-gradient(135deg,rgba(0,212,255,.2),rgba(124,242,194,.12));border-color:rgba(0,212,255,.45);color:var(--accent);box-shadow:0 0 20px rgba(0,212,255,.1);}
    .btn.primary:hover{background:linear-gradient(135deg,rgba(0,212,255,.3),rgba(124,242,194,.2));box-shadow:0 0 30px rgba(0,212,255,.2);}
    .btn.success{background:rgba(16,185,129,.12);border-color:rgba(16,185,129,.35);color:#6ee7b7;}
    .btn.success:hover{background:rgba(16,185,129,.22);}
    .btn.danger{border-color:rgba(255,77,109,.3);color:var(--hot);}
    .btn.danger:hover{border-color:rgba(255,77,109,.6);background:rgba(255,77,109,.1);}
    .btn.warn{background:rgba(245,158,11,.1);border-color:rgba(245,158,11,.3);color:#fcd34d;}
    .btn.warn:hover{background:rgba(245,158,11,.2);}
    .btn.ghost{background:transparent;border-color:transparent;}
    .btn.ghost:hover{background:var(--surface);border-color:var(--border);}
    .btn.active-on{background:rgba(0,212,255,.18);border-color:rgba(0,212,255,.45);color:var(--accent);}
    .btn.green{border-color:rgba(124,242,194,.3);color:var(--accent2);}
    .btn.green:hover{border-color:rgba(124,242,194,.6);background:rgba(124,242,194,.08);}
    .btn.ai{
      background:linear-gradient(135deg,rgba(155,35,53,.25),rgba(255,77,109,.1));
      border-color:rgba(155,35,53,.6);color:#ff8fa3;position:relative;overflow:hidden;
    }
    .btn.ai::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,77,109,.1),transparent);transform:translateX(-100%);transition:transform .4s;}
    .btn.ai:hover::before{transform:translateX(100%);}
    .btn.ai:hover{box-shadow:0 0 25px rgba(155,35,53,.3);border-color:rgba(155,35,53,.9);}
    .back-nav{
      display:flex;align-items:center;gap:7px;padding:7px 14px;
      border-radius:var(--r3);border:1px solid var(--border);
      background:rgba(0,212,255,.06);color:var(--accent);cursor:pointer;
      font-family:var(--font-d);font-size:12px;font-weight:600;letter-spacing:1px;
      transition:all .2s;text-transform:uppercase;text-decoration:none;
    }
    .back-nav:hover{border-color:rgba(0,212,255,.5);background:rgba(0,212,255,.12);box-shadow:0 0 20px rgba(0,212,255,.15);}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB CONTENT LAYOUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .tab-content{display:none;animation:fadeIn .25s ease;}
    .tab-content.active{display:block;}
    .hidden{display:none!important;}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EVENTS TAB STYLES  (scoped under #eventsTab)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #eventsTab{
      max-width:1040px;margin:0 auto;padding:24px 18px 80px;position:relative;z-index:1;
    }

    /* Page header */
    .page-header{display:flex;align-items:flex-start;justify-content:space-between;gap:20px;flex-wrap:wrap;margin-bottom:20px;}
    .page-eyebrow{font-family:var(--font-m);font-size:10px;letter-spacing:.15em;color:var(--accent);text-transform:uppercase;margin-bottom:6px;}
    .page-title{font-family:var(--font-d);font-size:clamp(28px,5vw,48px);font-weight:700;letter-spacing:-.01em;line-height:1;text-transform:uppercase;}
    .page-title span{color:var(--accent);}
    .page-sub{margin-top:8px;font-size:14px;color:var(--muted2);max-width:60ch;line-height:1.6;}
    .page-sub code{font-family:var(--font-m);font-size:12px;color:var(--accent);padding:1px 5px;border-radius:4px;background:rgba(0,212,255,.1);}
    .page-actions{display:flex;align-items:center;gap:8px;flex-wrap:wrap;padding-top:4px;}

    /* Stats bar */
    .ev-stats-bar{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;margin-bottom:20px;}
    .ev-stat-card{
      border:1px solid var(--border);border-radius:var(--r2);
      background:linear-gradient(160deg,rgba(14,26,47,.9),rgba(11,18,36,.9));
      padding:12px 14px;backdrop-filter:blur(12px);
    }
    .ev-stat-label{font-family:var(--font-m);font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin-bottom:4px;}
    .ev-stat-value{font-family:var(--font-d);font-size:26px;font-weight:700;line-height:1;}
    .sv-blue{color:#60a5fa;} .sv-green{color:#34d399;} .sv-gold{color:#fbbf24;} .sv-purple{color:#a78bfa;}

    /* Panel (events form panel) */
    .ev-panel{border:1px solid var(--border2);border-radius:var(--r);background:var(--card);backdrop-filter:blur(16px);box-shadow:var(--shadow2);overflow:hidden;margin-bottom:20px;}
    .ev-panel-header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 18px;border-bottom:1px solid var(--border);background:rgba(0,212,255,.03);}
    .ev-panel-title{font-family:var(--font-d);font-size:16px;font-weight:700;letter-spacing:.04em;text-transform:uppercase;}
    .ev-panel-hint{font-family:var(--font-m);font-size:10px;color:var(--muted);letter-spacing:.04em;}
    .ev-panel-body{padding:18px;}

    /* Form */
    #eventsTab .form-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px;}
    #eventsTab .form-group{display:flex;flex-direction:column;gap:6px;}
    #eventsTab .form-group.span2{grid-column:span 2;}
    #eventsTab label{font-family:var(--font-m);font-size:10px;letter-spacing:.1em;text-transform:uppercase;color:var(--muted2);display:block;}
    #eventsTab input,#eventsTab select{
      width:100%;padding:10px 13px;border-radius:var(--r3);
      background:rgba(0,0,0,.4);border:1px solid var(--border);
      color:var(--text);font-family:var(--font-b);font-size:14px;outline:none;
      transition:border-color .15s,box-shadow .15s;
    }
    #eventsTab input:focus,#eventsTab select:focus{border-color:rgba(0,212,255,.5);box-shadow:0 0 0 3px rgba(0,212,255,.1);}
    #eventsTab select option{background:var(--bg2);}
    #eventsTab input[type="file"]{padding:8px 12px;font-size:13px;color:var(--muted2);}
    #eventsTab input[type="number"]{-moz-appearance:textfield;}
    #eventsTab input[type="number"]::-webkit-outer-spin-button,
    #eventsTab input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;}

    .upload-pair{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
    .upload-box{border:1px dashed var(--border2);border-radius:var(--r3);padding:12px;text-align:center;cursor:pointer;position:relative;background:rgba(0,0,0,.15);transition:border-color .15s,background .15s;}
    .upload-box:hover{border-color:rgba(0,212,255,.4);background:rgba(0,212,255,.05);}
    .upload-box input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
    .upload-box-icon{font-size:20px;margin-bottom:4px;}
    .upload-box-label{font-size:11px;color:var(--muted2);font-family:var(--font-m);letter-spacing:.05em;}
    .upload-preview{width:100%;max-height:60px;object-fit:contain;border-radius:6px;display:none;margin-top:4px;}

    .location-row{display:flex;gap:10px;align-items:center;}
    .flag-up{width:42px;height:42px;flex:0 0 42px;border-radius:var(--r3);border:1px solid var(--border2);background:rgba(0,0,0,.25);display:grid;place-items:center;cursor:pointer;position:relative;overflow:hidden;transition:border-color .15s,box-shadow .15s;}
    .flag-up:hover{border-color:rgba(0,212,255,.4);box-shadow:0 0 24px rgba(0,212,255,.2);}
    .flag-up img{width:100%;height:100%;object-fit:contain;}
    .flag-emoji{font-size:18px;}
    .flag-badge{position:absolute;bottom:2px;right:2px;font-size:7px;padding:1px 4px;border-radius:4px;background:rgba(0,0,0,.55);color:rgba(229,231,235,.8);pointer-events:none;}
    .match-inputs{display:flex;flex-direction:column;gap:8px;}

    .form-actions{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:16px;padding-top:16px;border-top:1px solid var(--border);}
    .form-feedback{font-size:12px;line-height:1.5;padding:6px 10px;border-radius:var(--r3);display:none;}
    .form-feedback.error{color:#fca5a5;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);}
    .form-feedback.ok{color:#6ee7b7;background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);}
    .form-feedback.info{color:#93c5fd;background:rgba(0,212,255,.08);border:1px solid rgba(0,212,255,.15);}

    /* Filter bar */
    .filter-bar{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:16px;}
    .filter-group{display:flex;align-items:center;gap:4px;background:var(--card);border:1px solid var(--border);border-radius:var(--r3);padding:4px;}
    .filter-btn{padding:5px 12px;border-radius:6px;border:none;background:transparent;color:var(--muted2);font-size:12px;font-weight:600;cursor:pointer;transition:all .15s;}
    .filter-btn:hover{color:var(--text);background:var(--surface);}
    .filter-btn.active{background:var(--surface2);color:var(--text);}
    .search-box{flex:1;min-width:160px;max-width:280px;padding:7px 12px;border-radius:var(--r3);border:1px solid var(--border);background:var(--card);color:var(--text);font-size:13px;outline:none;}
    .search-box:focus{border-color:rgba(0,212,255,.4);}
    .sort-select{padding:7px 12px;border-radius:var(--r3);border:1px solid var(--border);background:var(--card);color:var(--muted2);font-size:12px;outline:none;cursor:pointer;}
    .winner-filter{min-width:140px;}
    .winner-filter.has-selection{border-color:rgba(251,191,36,.35);color:var(--gold);}
    .medalist-filter{min-width:140px;}
    .medalist-filter.has-selection{border-color:rgba(168,85,247,.45);color:#c4b5fd;}

    /* Event cards */
    .events-list{display:flex;flex-direction:column;gap:14px;}
    :root{--logo-size:clamp(72px,9vw,108px);}
    .event-card{
      position:relative;border:1px solid var(--border);border-radius:var(--r);
      background:var(--card);backdrop-filter:blur(14px);box-shadow:var(--shadow2);overflow:hidden;
      transition:transform .2s ease,border-color .2s ease,box-shadow .2s ease;
    }
    .event-card:hover{transform:translateY(-2px);border-color:rgba(0,212,255,.25);box-shadow:var(--shadow);}
    .event-card.is-live{border-color:rgba(34,197,94,.22);}
    .event-card.is-live:hover{border-color:rgba(34,197,94,.38);box-shadow:var(--shadow),var(--glow-live);}
    .event-card.is-major{border-color:rgba(251,191,36,.18);}
    .event-card.is-major:hover{border-color:rgba(251,191,36,.35);box-shadow:var(--shadow),var(--glow-gold);}

    .card-bg{position:absolute;inset:0;background-image:var(--ev-bg,none);background-size:cover;background-position:center;opacity:.06;filter:blur(12px) saturate(1.5);pointer-events:none;z-index:0;transition:opacity .3s;}
    .event-card:hover .card-bg{opacity:.1;}
    .card-accent{position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--ac,rgba(0,212,255,.7)),transparent);z-index:1;}

    .card-inner{position:relative;z-index:2;display:grid;grid-template-columns:clamp(72px,9vw,108px) 1fr;gap:16px;padding:18px;align-items:start;}
    .logo-box{width:clamp(72px,9vw,108px);height:clamp(72px,9vw,108px);border-radius:14px;border:1px solid var(--border2);background:rgba(0,0,0,.2);display:grid;place-items:center;overflow:hidden;flex-shrink:0;}
    .logo-box img{width:100%;height:100%;object-fit:contain;}
    .logo-ph{font-size:28px;opacity:.7;}

    .ev-head{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:12px;}
    .ev-name-row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
    .ev-name{font-family:var(--font-d);font-size:20px;font-weight:700;letter-spacing:-.01em;text-transform:uppercase;color:var(--text);text-decoration:none;transition:color .15s;}
    .ev-name:hover{color:var(--accent);}

    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-family:var(--font-m);font-size:10px;letter-spacing:.04em;text-transform:uppercase;border:1px solid var(--border);background:var(--surface);color:var(--muted2);white-space:nowrap;}
    .pill.live{border-color:rgba(34,197,94,.3);background:rgba(34,197,94,.1);color:#86efac;}
    .pill.live::before{content:"";width:6px;height:6px;border-radius:50%;background:var(--live);box-shadow:0 0 8px var(--live);animation:blink 1.5s ease-in-out infinite;}
    .pill.finished{border-color:rgba(0,212,255,.2);color:var(--accent);background:rgba(0,212,255,.07);}
    .pill.major{border-color:rgba(251,191,36,.3);background:rgba(251,191,36,.08);color:#fcd34d;}

    .stars-row{display:inline-flex;gap:2px;align-items:center;}
    .star{font-size:13px;color:rgba(255,255,255,.18);}
    .star.on{color:var(--gold);filter:drop-shadow(0 0 4px rgba(251,191,36,.5));}

    .ev-meta{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;margin-bottom:12px;}
    .meta-kv{border:1px solid var(--border);background:rgba(0,0,0,.2);border-radius:var(--r3);padding:9px 11px;}
    .meta-k{font-family:var(--font-m);font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);margin-bottom:3px;}
    .meta-v{font-size:13px;color:var(--text);line-height:1.3;}

    .flag-mini{width:22px;height:14px;border-radius:3px;border:1px solid var(--border);object-fit:fill;vertical-align:-2px;margin-right:5px;display:inline-block;}

    .live-block{border:1px solid rgba(34,197,94,.2);background:rgba(34,197,94,.05);border-radius:var(--r3);padding:12px;margin-bottom:10px;}
    .live-block-head{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:10px;flex-wrap:wrap;}
    .live-block-title{font-family:var(--font-d);font-size:13px;font-weight:700;letter-spacing:.05em;text-transform:uppercase;color:#86efac;}
    .match-list{display:flex;flex-direction:column;gap:6px;}
    .match-row{display:flex;align-items:center;gap:10px;padding:8px 10px;border-radius:var(--r3);border:1px solid var(--border);background:rgba(0,0,0,.2);font-size:13px;}
    .match-row span:last-child{margin-left:auto;color:var(--muted2);font-size:12px;}

    .finished-block{border:1px solid rgba(0,212,255,.18);background:rgba(0,212,255,.04);border-radius:var(--r3);padding:12px;margin-bottom:10px;}
    .winner-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap;}
    .winner-label{font-family:var(--font-m);font-size:9px;letter-spacing:.12em;text-transform:uppercase;color:var(--muted);}
    .winner-name{font-family:var(--font-d);font-size:18px;font-weight:700;letter-spacing:-.01em;text-transform:uppercase;color:var(--gold);}
    .trophy-img{width:24px;height:24px;border-radius:6px;border:1px solid var(--border);object-fit:contain;}
    .runner-up-row{font-size:12px;color:var(--muted2);margin-bottom:10px;}
    .runner-up-row strong{color:var(--text);}
    .highlights-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:7px;}
    .hl-chip{border:1px solid var(--border);background:rgba(0,0,0,.18);border-radius:var(--r3);padding:7px 9px;font-size:12px;color:var(--muted2);}
    .hl-chip strong{color:var(--text);display:block;font-size:10px;font-family:var(--font-m);letter-spacing:.08em;text-transform:uppercase;margin-bottom:2px;}

    .edit-bar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;padding-top:10px;border-top:1px solid var(--border);}

    /* Analysis modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);z-index:200;display:grid;place-items:center;padding:20px;opacity:0;pointer-events:none;transition:opacity .25s;}
    .modal-overlay.open{opacity:1;pointer-events:all;}
    .modal{width:100%;max-width:640px;border:1px solid var(--border2);border-radius:var(--r);background:var(--bg2);box-shadow:0 40px 100px rgba(0,0,0,.8);overflow:hidden;transform:translateY(20px);transition:transform .25s ease;}
    .modal-overlay.open .modal{transform:translateY(0);}
    .modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border);background:rgba(0,212,255,.03);}
    .modal-title{font-family:var(--font-d);font-size:18px;font-weight:700;text-transform:uppercase;letter-spacing:.04em;}
    .modal-body{padding:20px;max-height:70vh;overflow-y:auto;}
    .a-section{margin-bottom:16px;}
    .a-section-title{font-family:var(--font-m);font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:var(--accent);margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid var(--border);}
    .a-item{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;border-radius:var(--r3);border:1px solid var(--border);background:var(--surface);margin-bottom:6px;font-size:13px;line-height:1.5;}
    .a-icon{font-size:16px;flex-shrink:0;margin-top:1px;}
    .a-bar-row{margin-bottom:10px;}
    .a-bar-label{display:flex;justify-content:space-between;font-size:12px;color:var(--muted2);margin-bottom:5px;}
    .a-bar-label strong{color:var(--text);}
    .a-bar-track{height:6px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;}
    .a-bar-fill{height:100%;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .8s ease;}
    .a-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;}
    .a-hl{border:1px solid var(--border);border-radius:var(--r3);padding:12px;background:var(--surface);}
    .a-hl-val{font-family:var(--font-d);font-size:24px;font-weight:700;color:var(--accent);line-height:1;}
    .a-hl-desc{font-size:11px;color:var(--muted);margin-top:4px;}

    /* Empty */
    .empty-state{text-align:center;padding:60px 20px;border:1px dashed var(--border2);border-radius:var(--r);}
    .empty-icon{font-size:48px;margin-bottom:12px;opacity:.5;}
    .empty-title{font-family:var(--font-d);font-size:24px;font-weight:700;text-transform:uppercase;color:var(--muted2);margin-bottom:6px;}
    .empty-sub{font-size:14px;color:var(--muted);}

    /* Events footer */
    .ev-footer{margin-top:24px;padding-top:16px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;}
    .footer-text{font-family:var(--font-m);font-size:10px;color:var(--muted);letter-spacing:.04em;}
    .footer-text span{padding:2px 6px;border-radius:4px;border:1px solid var(--border);background:rgba(0,0,0,.2);}

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEEDING TAB STYLES  (scoped under #seedingTab)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #seedingTab{
      max-width:1200px;margin:0 auto;padding:24px 24px 80px;position:relative;z-index:1;
    }

    #seedingTab .section{margin-bottom:20px;}
    .section-header{display:flex;align-items:center;gap:12px;margin-bottom:14px;}
    .section-num{
      width:28px;height:28px;border-radius:6px;
      background:linear-gradient(135deg,rgba(0,212,255,.2),rgba(0,212,255,.05));
      border:1px solid rgba(0,212,255,.35);
      display:flex;align-items:center;justify-content:center;
      font-family:var(--font-m);font-size:12px;color:var(--accent);flex-shrink:0;
    }
    .section-title{font-family:var(--font-d);font-size:16px;font-weight:700;letter-spacing:2px;color:var(--text);text-transform:uppercase;}
    .section-line{flex:1;height:1px;background:linear-gradient(90deg,rgba(0,212,255,.3),transparent);}

    .sd-card{
      background:linear-gradient(160deg,rgba(14,26,47,.95),rgba(11,18,36,.95));
      border:1px solid var(--border);border-radius:16px;padding:20px;position:relative;overflow:hidden;
    }
    .sd-card::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(0,212,255,.4),transparent);opacity:.6;}

    /* Load state */
    .load-state{display:flex;align-items:center;gap:10px;padding:12px 16px;border-radius:10px;border:1px dashed rgba(0,212,255,.25);background:rgba(0,212,255,.03);font-family:var(--font-m);font-size:12px;color:var(--muted);}
    .load-state.ok{border-color:rgba(124,242,194,.35);color:var(--accent2);}
    .load-state.err{border-color:rgba(255,77,109,.4);color:var(--hot);}

    /* Fallback */
    details.fallback{margin-top:14px;border:1px solid var(--border);border-radius:var(--r3);overflow:hidden;}
    details.fallback summary{padding:12px 16px;cursor:pointer;font-family:var(--font-d);font-size:13px;font-weight:600;letter-spacing:1px;color:var(--muted);background:rgba(0,212,255,.04);user-select:none;list-style:none;display:flex;align-items:center;gap:8px;}
    details.fallback summary::before{content:'â–¸';}
    details[open].fallback summary::before{content:'â–¾';}
    details.fallback summary:hover{color:var(--text);}
    .fallback-body{padding:14px 16px;border-top:1px solid var(--border);}

    /* Seeding form elements */
    #seedingTab .row{display:flex;align-items:flex-start;gap:10px;flex-wrap:wrap;margin-top:10px;}
    #seedingTab .field{display:flex;flex-direction:column;gap:6px;min-width:220px;}
    #seedingTab .field.grow{flex:1;}
    #seedingTab label{font-family:var(--font-d);font-size:11px;font-weight:600;letter-spacing:2px;color:var(--muted);text-transform:uppercase;}
    #seedingTab input,#seedingTab textarea,#seedingTab select{
      width:100%;padding:10px 14px;border-radius:10px;border:1px solid var(--border);
      background:rgba(0,8,20,.6);color:var(--text);outline:none;
      font-family:var(--font-b);font-size:13px;transition:border-color .2s,box-shadow .2s;
    }
    #seedingTab textarea{min-height:80px;resize:vertical;}
    #seedingTab input:focus,#seedingTab textarea:focus{border-color:rgba(0,212,255,.5);box-shadow:0 0 0 3px rgba(0,212,255,.06);}

    /* Team list */
    .list-wrap{margin-top:14px;}
    .list-head{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:rgba(0,212,255,.04);border:1px solid var(--border);border-bottom:none;border-radius:10px 10px 0 0;font-family:var(--font-d);font-size:11px;font-weight:600;letter-spacing:2px;color:var(--muted);text-transform:uppercase;}
    .list-head span:last-child{font-family:var(--font-m);font-size:11px;}
    .team-list{max-height:320px;overflow:auto;border:1px solid var(--border);border-radius:0 0 10px 10px;padding:8px;background:rgba(0,5,15,.4);scrollbar-width:thin;scrollbar-color:rgba(0,212,255,.2) transparent;}
    .team-item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 10px;border-radius:8px;cursor:pointer;transition:background .15s;animation:slideIn .2s ease both;}
    .team-item:hover{background:rgba(0,212,255,.05);}
    .team-left{display:flex;align-items:center;gap:10px;}
    .team-left input[type=checkbox]{width:15px;height:15px;accent-color:var(--accent);cursor:pointer;flex-shrink:0;}
    .team-name{font-size:13px;font-weight:500;color:var(--text);}
    .team-pts{font-family:var(--font-m);font-size:11px;color:var(--muted);margin-top:1px;}
    .seed-badge{font-family:var(--font-m);font-size:11px;color:var(--muted);background:rgba(0,212,255,.06);border:1px solid rgba(0,212,255,.12);padding:2px 8px;border-radius:5px;}

    .region-badge{font-family:var(--font-m);font-size:10px;padding:2px 6px;border-radius:4px;background:rgba(124,242,194,.08);border:1px solid rgba(124,242,194,.2);color:var(--accent2);}
    .tier-badge{font-family:var(--font-m);font-size:10px;padding:2px 6px;border-radius:4px;}
    .tier-badge.t1{background:rgba(255,215,0,.08);border:1px solid rgba(255,215,0,.25);color:#ffd700;}
    .tier-badge.t2{background:rgba(192,192,192,.08);border:1px solid rgba(192,192,192,.2);color:#c0c0c0;}
    .tier-badge.t3{background:rgba(205,127,50,.08);border:1px solid rgba(205,127,50,.2);color:#cd7f32;}

    /* Selected table */
    .selected-table{font-family:var(--font-m);font-size:12px;line-height:1.8;color:var(--text);white-space:pre-wrap;padding:12px;border:1px solid var(--border);border-radius:var(--r3);background:rgba(0,5,15,.4);max-height:380px;overflow:auto;scrollbar-width:thin;scrollbar-color:rgba(0,212,255,.2) transparent;}

    /* Dual grid */
    .dual-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;}
    @media(max-width:900px){.dual-grid{grid-template-columns:1fr;}}

    .sd-panel{background:rgba(0,5,15,.35);border:1px solid var(--border);border-radius:14px;padding:14px;}
    .sd-panel-title{font-family:var(--font-d);font-size:12px;font-weight:700;letter-spacing:2px;color:var(--muted);text-transform:uppercase;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(0,212,255,.06);display:flex;align-items:center;gap:8px;}
    .sd-panel-title span{width:6px;height:6px;border-radius:50%;background:var(--accent);display:inline-block;animation:pulse 2s infinite;}

    /* Matchups */
    .matchups{display:flex;flex-direction:column;gap:10px;max-height:600px;overflow:auto;scrollbar-width:thin;scrollbar-color:rgba(0,212,255,.2) transparent;}
    .match-card{border:1px solid var(--border);border-radius:12px;background:rgba(0,8,20,.5);overflow:hidden;animation:matchReveal .25s ease both;}
    .match-hdr{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(0,212,255,.04);border-bottom:1px solid rgba(0,212,255,.06);font-family:var(--font-d);font-size:11px;font-weight:700;letter-spacing:2px;color:var(--muted);text-transform:uppercase;}
    .match-hdr strong{color:var(--accent);font-size:12px;}
    .match-body{display:grid;grid-template-columns:1fr auto 1fr;gap:8px;padding:10px 12px;align-items:center;}
    .team-box{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:rgba(255,255,255,.02);transition:all .2s;}
    .team-box.wine{border-color:rgba(155,35,53,.7);background:linear-gradient(135deg,rgba(155,35,53,.18),rgba(0,0,0,.1));box-shadow:0 0 20px rgba(155,35,53,.12);}
    .team-box.wine .tname{color:#ffc0cb;}
    .team-box.bye{border-color:rgba(124,242,194,.25);background:rgba(124,242,194,.04);}
    .tname{font-weight:600;font-size:13px;display:block;}
    .tinfo{font-family:var(--font-m);font-size:11px;color:var(--muted);margin-top:3px;}
    .vs-badge{font-family:var(--font-d);font-size:14px;font-weight:700;color:var(--accent);text-align:center;letter-spacing:1px;}

    /* AI Analysis Panel */
    .ai-panel{margin-top:16px;border:1px solid rgba(155,35,53,.3);border-radius:14px;overflow:hidden;display:none;}
    .ai-panel.visible{display:block;animation:gridFade .3s ease;}
    .ai-header{display:flex;align-items:center;gap:10px;padding:12px 16px;background:linear-gradient(90deg,rgba(155,35,53,.15),rgba(0,0,0,.1));border-bottom:1px solid rgba(155,35,53,.2);}
    .ai-header span{font-family:var(--font-d);font-size:13px;font-weight:700;letter-spacing:2px;color:#ff8fa3;text-transform:uppercase;flex:1;}
    .ai-body{padding:16px;}
    .analysis-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-bottom:16px;}
    .sd-stat-card{padding:12px 14px;border:1px solid var(--border);border-radius:10px;background:rgba(0,5,15,.5);}
    .sd-stat-label{font-family:var(--font-d);font-size:10px;font-weight:700;letter-spacing:2px;color:var(--muted);text-transform:uppercase;margin-bottom:6px;}
    .sd-stat-value{font-family:var(--font-d);font-size:22px;font-weight:700;color:var(--accent);}
    .sd-stat-value.hot{color:var(--hot);}
    .sd-stat-value.green{color:var(--accent2);}
    .sd-stat-sub{font-family:var(--font-m);font-size:10px;color:var(--muted);margin-top:3px;}

    .match-analysis{display:flex;flex-direction:column;gap:8px;}
    .ma-row{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;background:rgba(0,5,15,.5);border:1px solid var(--border);}
    .ma-num{font-family:var(--font-m);font-size:11px;color:var(--muted);min-width:58px;}
    .ma-teams{flex:1;font-size:13px;font-weight:500;}
    .ma-bar-wrap{min-width:100px;}
    .ma-bar{height:4px;border-radius:2px;background:rgba(0,212,255,.12);overflow:hidden;}
    .ma-bar-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--hot),var(--accent));transition:width .6s ease;}
    .ma-delta{font-family:var(--font-m);font-size:11px;color:var(--muted);min-width:70px;text-align:right;}
    .ma-tag{font-family:var(--font-m);font-size:10px;padding:2px 8px;border-radius:4px;min-width:72px;text-align:center;}
    .ma-tag.upset{background:rgba(255,77,109,.12);border:1px solid rgba(255,77,109,.3);color:var(--hot);}
    .ma-tag.predicted{background:rgba(124,242,194,.08);border:1px solid rgba(124,242,194,.2);color:var(--accent2);}
    .ma-tag.tossup{background:rgba(0,212,255,.08);border:1px solid rgba(0,212,255,.2);color:var(--accent);}

    .sd-divider{height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin:14px 0;}
    .insight-list{display:flex;flex-direction:column;gap:8px;}
    .insight{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;border-radius:10px;background:rgba(0,5,15,.4);border-left:3px solid;font-size:13px;line-height:1.5;}
    .insight.info{border-color:var(--accent);}
    .insight.warn{border-color:var(--hot);}
    .insight.ok{border-color:var(--accent2);}
    .insight-icon{font-size:15px;flex-shrink:0;margin-top:1px;}

    .gen-info{font-family:var(--font-m);font-size:12px;color:var(--muted);margin-top:12px;min-height:18px;}
    .hint{font-family:var(--font-m);font-size:11px;color:var(--muted);line-height:1.6;margin-bottom:14px;}
    .hint code{color:var(--accent);background:rgba(0,212,255,.08);padding:1px 5px;border-radius:4px;}
    kbd{border:1px solid var(--border);border-bottom-color:rgba(0,212,255,.3);padding:2px 7px;border-radius:6px;background:rgba(0,8,20,.6);font-family:var(--font-m);font-size:11px;color:var(--muted);}
    .quick-actions{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-top:12px;}
    .selct-count-badge{font-family:var(--font-m);font-size:12px;padding:4px 10px;border-radius:6px;background:rgba(0,212,255,.08);border:1px solid rgba(0,212,255,.2);color:var(--accent);}
    .spinner{width:14px;height:14px;border:2px solid rgba(0,212,255,.2);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;display:inline-block;flex-shrink:0;}

    /* Shared footer */
    .sd-footer{max-width:1200px;margin:0 auto;padding:0 24px 40px;font-family:var(--font-m);font-size:11px;color:var(--muted);position:relative;z-index:1;}

    /* â”€â”€ SCROLLBARS â”€â”€ */
    ::-webkit-scrollbar{width:5px;height:5px;}
    ::-webkit-scrollbar-track{background:transparent;}
    ::-webkit-scrollbar-thumb{background:rgba(0,212,255,.2);border-radius:3px;}
    ::-webkit-scrollbar-thumb:hover{background:rgba(0,212,255,.4);}

    /* â”€â”€ RESPONSIVE â”€â”€ */
    @media(max-width:820px){
      .topnav{flex-wrap:wrap;gap:8px;}
      .topnav-right{margin-left:0;}
      .ev-stats-bar{grid-template-columns:repeat(2,1fr);}
      #eventsTab .form-grid{grid-template-columns:1fr;}
      #eventsTab .form-group.span2{grid-column:span 1;}
      .card-inner{grid-template-columns:1fr;}
      .ev-meta{grid-template-columns:1fr 1fr;}
      .highlights-grid{grid-template-columns:1fr 1fr;}
      .upload-pair{grid-template-columns:1fr;}
    }
    @media(max-width:480px){
      .ev-stats-bar{grid-template-columns:1fr 1fr;}
      .ev-meta{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>

<div class="scanline"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EVENTS ANALYSIS MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="analysisModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">âš¡ Intelligence Analysis</div>
      <button class="btn ghost" id="closeAnalysis" style="padding:6px 10px;">âœ•</button>
    </div>
    <div class="modal-body" id="analysisContent"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOP NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="topnav">
  <a class="brand" href="index.html">
    <div class="brand-icon">â¬¡</div>
    <div>
      <div class="brand-name">NEXUS</div>
      <div class="brand-sub">COMMAND CENTER</div>
    </div>
  </a>

  <div class="nav-sep"></div>

  <!-- TAB SWITCHER -->
  <div class="tab-pills">
    <button class="tab-pill active" data-tab="eventsTab">ğŸ“‹ Events</button>
    <button class="tab-pill" data-tab="seedingTab">âš” Match Generator</button>
  </div>

  <div class="topnav-right">
    <!-- Events-only controls -->
    <div class="ev-controls" id="evControls">
      <div class="status-chip" id="statusChip" title="Source: file/kz-events-backup.json">
        <div class="s-dot loading" id="statusDot"></div>
        <span id="statusLabel">Loadingâ€¦</span>
      </div>
      <button class="btn" id="reloadBtn" title="Force re-fetch JSON">â†º Reload</button>
      <button class="btn" id="exportBtn" title="Ctrl+Shift+S">â¬‡ Export</button>
      <button class="btn" id="importBtn" title="Ctrl+Shift+O">â¬† Import</button>
    </div>

    <!-- Seeding-only status -->
    <div id="sdStatus" style="display:none;align-items:center;gap:8px;font-family:var(--font-m);font-size:11px;color:var(--muted);">
      <div class="status-dot-sd" id="topStatusDot"></div>
      <span id="topStatusText">Initializingâ€¦</span>
    </div>

    <a class="back-nav" href="index.html" title="Shortcut: 0">âŸµ Back</a>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EVENTS TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content active" id="eventsTab">

  <!-- PAGE HEADER -->
  <div class="page-header">
    <div>
      <div class="page-eyebrow">// Tournament Intelligence</div>
      <h1 class="page-title">Event <span>Registry</span></h1>
      <p class="page-sub">
        Loads from <code>file/kz-events-backup.json</code> on every visit.
        Export after changes and push the file to keep data permanent.
      </p>
    </div>
    <div class="page-actions">
      <button class="btn warn" id="analysisBtn">âš¡ Analyse</button>
      <button class="btn" id="updateBtn">âœ Update: OFF</button>
      <button class="btn primary" id="toggleAddBtn">ï¼‹ Add Event</button>
    </div>
  </div>

  <!-- STATS -->
  <div class="ev-stats-bar">
    <div class="ev-stat-card"><div class="ev-stat-label">Total Events</div><div class="ev-stat-value sv-blue" id="statTotal">0</div></div>
    <div class="ev-stat-card"><div class="ev-stat-label">Live Now</div><div class="ev-stat-value sv-green" id="statLive">0</div></div>
    <div class="ev-stat-card"><div class="ev-stat-label">Majors</div><div class="ev-stat-value sv-gold" id="statMajors">0</div></div>
    <div class="ev-stat-card"><div class="ev-stat-label">Total Prize Pool</div><div class="ev-stat-value sv-purple" id="statPrize">â€”</div></div>
  </div>

  <!-- ADD / EDIT PANEL -->
  <section class="ev-panel hidden" id="addPanel">
    <div class="ev-panel-header">
      <div class="ev-panel-title" id="panelTitle">Add New Event</div>
      <div class="ev-panel-hint">* required fields</div>
    </div>
    <div class="ev-panel-body">
      <div class="upload-pair">
        <div class="upload-box">
          <input type="file" id="eventLogo" accept="image/*">
          <div class="upload-box-icon">ğŸ¯</div>
          <div class="upload-box-label">Event Logo</div>
          <img class="upload-preview" id="eventLogoPreview">
        </div>
        <div class="upload-box">
          <input type="file" id="trophyLogo" accept="image/*">
          <div class="upload-box-icon">ğŸ†</div>
          <div class="upload-box-label">Trophy Logo</div>
          <img class="upload-preview" id="trophyLogoPreview">
        </div>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label>Event Name *</label>
          <input id="name" placeholder="e.g. IEM Katowice 2026">
        </div>
        <div class="form-group">
          <label>Google Drive Link *</label>
          <input id="link" placeholder="https://drive.google.com/â€¦">
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="status">
            <option value="Finished">Finished</option>
            <option value="Live">Live</option>
          </select>
        </div>
        <div class="form-group">
          <label>Time / Period</label>
          <input id="time" placeholder="Jan 2026 / 10â€“20 Jan 2026 / Live">
        </div>
        <div class="form-group">
          <label>Prize Pool</label>
          <input id="prizePool" placeholder="$1,000,000">
        </div>
        <div class="form-group">
          <label>Teams</label>
          <input id="teams" type="number" min="0" placeholder="16">
        </div>
        <div class="form-group">
          <label>Location</label>
          <div class="location-row">
            <label class="flag-up" for="flagUpload" title="Upload flag image">
              <span class="flag-emoji" id="flagEmoji">ğŸ³ï¸</span>
              <img id="flagPreview" alt="flag" style="display:none;width:100%;height:100%;object-fit:contain;">
              <span class="flag-badge">flag</span>
            </label>
            <input id="location" placeholder="City, Country" style="flex:1;">
          </div>
          <input id="flagUpload" type="file" accept="image/*" class="hidden">
        </div>
        <div class="form-group">
          <label>Importance (1â€“5)</label>
          <input id="importance" type="number" min="1" max="5" placeholder="3">
        </div>
        <div class="form-group">
          <label>Major?</label>
          <select id="major">
            <option value="false">No</option>
            <option value="true">Yes</option>
          </select>
        </div>

        <div class="form-group hidden" id="liveOnlyA">
          <label>Stage (Live)</label>
          <input id="stage" placeholder="Playoffs â€” Semifinals">
        </div>
        <div class="form-group span2 hidden" id="liveOnlyB">
          <label>Next Matches (max 3) â€” Team A vs Team B â€“ Time</label>
          <div class="match-inputs">
            <input id="m1" placeholder="Natus Vincere vs FaZe â€“ Today 18:00">
            <input id="m2" placeholder="Team Spirit vs G2 â€“ Today 21:00">
            <input id="m3" placeholder="FURIA vs Cloud9 â€“ Tomorrow 15:00">
          </div>
        </div>

        <div class="form-group hidden" id="finishedOnlyA">
          <label>Winner Team</label>
          <input id="winnerTeam" placeholder="Winner team name">
        </div>
        <div class="form-group hidden" id="finishedOnlyA2">
          <label>2nd Place Team</label>
          <input id="runnerUpTeam" placeholder="Runner-up name">
        </div>
        <div class="form-group hidden" id="finishedOnlyB">
          <label>MVP / EVP / VP</label>
          <div class="match-inputs">
            <input id="mvp" placeholder="MVP player">
            <input id="evp" placeholder="EVP player">
            <input id="vp"  placeholder="VP player">
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button class="btn success" id="submitBtn">ï¼‹ Add Event</button>
        <button class="btn hidden" id="cancelEditBtn">âœ• Cancel</button>
        <button class="btn ghost" id="clearAllBtn">Clear Form</button>
        <div class="form-feedback" id="formFeedback"></div>
      </div>
    </div>
  </section>

  <!-- FILTERS -->
  <div class="filter-bar">
    <div class="filter-group">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="Live">Live</button>
      <button class="filter-btn" data-filter="Finished">Finished</button>
      <button class="filter-btn" data-filter="major">Majors</button>
    </div>
    <select class="sort-select winner-filter" id="winnerFilter" title="Filter by winner">
      <option value="">ğŸ† All Winners</option>
    </select>
    <select class="sort-select medalist-filter" id="medalistFilter" title="Filter by medalist">
      <option value="">ğŸ–ï¸ All Medalists</option>
    </select>
    <input class="search-box" id="searchBox" placeholder="Search eventsâ€¦" autocomplete="off">
    <select class="sort-select" id="sortSelect">
      <option value="newest">Newest first</option>
      <option value="oldest">Oldest first</option>
      <option value="importance">By importance</option>
      <option value="az">A â†’ Z</option>
    </select>
  </div>

  <!-- LIST -->
  <div class="events-list" id="eventsList"></div>

  <!-- FOOTER -->
  <div class="ev-footer">
    <div class="footer-text">
      Source: <span>file/kz-events-backup.json</span> &nbsp;Â·&nbsp; Cache: <span>localStorage</span>
    </div>
    <div class="footer-text">
      <span>Ctrl+Shift+A</span> Panel &nbsp;Â·&nbsp;
      <span>Ctrl+Shift+S</span> Export &nbsp;Â·&nbsp;
      <span>Ctrl+Shift+O</span> Import &nbsp;Â·&nbsp;
      <span>0</span> Back
    </div>
  </div>

</div><!-- /eventsTab -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SEEDING / MATCH GENERATOR TAB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="seedingTab">

  <!-- SECTION 1: Source -->
  <section class="section">
    <div class="section-header">
      <div class="section-num">01</div>
      <div class="section-title">Ranking Source</div>
      <div class="section-line"></div>
    </div>
    <div class="sd-card">
      <p class="hint">Reads <code>file/ranking.xlsx</code> â€” columns used: <code>Team</code>, <code>Points</code>, <code>Tier</code>, <code>Region</code>.</p>
      <div id="loadState" class="load-state">
        <div class="spinner"></div>
        <span>Loading ranking from Excelâ€¦</span>
      </div>
      <details class="fallback" id="fallbackBox">
        <summary>Can't read the Excel? Paste manually</summary>
        <div class="fallback-body">
          <p class="hint">Format: <code>Team Name;Points</code> (one per line, separator ";" or ",")</p>
          <textarea id="manualInput" placeholder="Team A;105&#10;Team B;90&#10;Team C;60"></textarea>
          <div class="row">
            <button id="useManual" class="btn">Use pasted data</button>
            <span id="manualStatus" class="hint" style="margin:0"></span>
          </div>
        </div>
      </details>
    </div>
  </section>

  <!-- SECTION 2: Pick teams -->
  <section class="section">
    <div class="section-header">
      <div class="section-num">02</div>
      <div class="section-title">Select Teams</div>
      <div class="section-line"></div>
    </div>
    <div class="sd-card">
      <div class="row">
        <div class="field">
          <label for="sdFilter">Search / Filter</label>
          <input id="sdFilter" type="text" placeholder="Type to filterâ€¦" autocomplete="off" />
        </div>
        <div class="field">
          <label for="regionFilter">Region</label>
          <select id="regionFilter">
            <option value="">All Regions</option>
          </select>
        </div>
        <div class="field">
          <label for="tierFilter">Tier</label>
          <select id="tierFilter">
            <option value="">All Tiers</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div class="field grow">
          <label for="bulkNames">Paste list (one name per line)</label>
          <textarea id="bulkNames" placeholder="Paste team names to auto-selectâ€¦"></textarea>
        </div>
      </div>
      <div class="quick-actions">
        <button id="applyBulk" class="btn">Select pasted</button>
        <button id="selectAll" class="btn green">Select all</button>
        <button id="clearSel" class="btn danger">Clear selection</button>
        <span id="selCount" class="selct-count-badge">0 selected</span>
      </div>
      <div class="list-wrap">
        <div class="list-head">
          <span>Teams in ranking</span>
          <span id="listCount">0 teams</span>
        </div>
        <div id="teamList" class="team-list"></div>
      </div>
    </div>
  </section>

  <!-- SECTION 3: Generate -->
  <section class="section">
    <div class="section-header">
      <div class="section-num">03</div>
      <div class="section-title">Matches</div>
      <div class="section-line"></div>
    </div>
    <div class="sd-card">
      <p class="hint">
        Seeding: <code>#1 vs last Â· #2 vs second-to-last</code> etc.
        Match order is <code>shuffled</code>. Sides are <code>randomized</code>.
        One team per match highlighted in <span style="color:#ff8fa3">wine</span>.
        Odd count â†’ BYE.
      </p>
      <div class="quick-actions">
        <button id="sdGenerate" class="btn primary">âš¡ Generate Matches</button>
        <button id="sdRegenerate" class="btn" disabled>â†º Regenerate</button>
        <button id="sdAnalyzeBtn" class="btn ai" disabled>â—ˆ AI Analysis</button>
        <button id="sdCopy" class="btn" disabled>â˜ Copy</button>
        <button id="sdDownload" class="btn" disabled>â†“ Download .txt</button>
      </div>
      <div id="genInfo" class="gen-info"></div>
      <div class="dual-grid">
        <div class="sd-panel">
          <div class="sd-panel-title"><span></span>Selected â€” sorted by points</div>
          <div id="selectedTable" class="selected-table">â€”</div>
        </div>
        <div class="sd-panel">
          <div class="sd-panel-title"><span></span>Matches â€” random order</div>
          <div id="matchups" class="matchups">
            <div style="color:var(--muted);font-family:var(--font-m);font-size:12px;padding:8px;">Generate matches to see them here.</div>
          </div>
        </div>
      </div>

      <!-- AI ANALYSIS PANEL -->
      <div class="ai-panel" id="aiPanel">
        <div class="ai-header">
          <span>â—ˆ Match Intelligence Report</span>
          <button class="btn danger" id="closeAI" style="padding:5px 10px;font-size:11px;">âœ• Close</button>
        </div>
        <div class="ai-body">
          <div class="analysis-grid" id="aiStats"></div>
          <div class="sd-divider"></div>
          <div class="sd-panel-title" style="margin-bottom:12px"><span></span>Match-by-match analysis</div>
          <div class="match-analysis" id="aiMatchAnalysis"></div>
          <div class="sd-divider"></div>
          <div class="sd-panel-title" style="margin-bottom:12px"><span></span>Insights</div>
          <div class="insight-list" id="aiInsights"></div>
        </div>
      </div>
    </div>
  </section>

  <footer class="sd-footer">
    Shortcut: press <kbd>0</kbd> (outside inputs) to return to <code>index.html</code>.
  </footer>

</div><!-- /seedingTab -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TAB SWITCHING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
  (function(){
    const pills = document.querySelectorAll('.tab-pill');
    const tabs  = document.querySelectorAll('.tab-content');
    const evCtrl = document.getElementById('evControls');
    const sdStat = document.getElementById('sdStatus');

    function switchTab(tabId){
      pills.forEach(p => p.classList.toggle('active', p.dataset.tab === tabId));
      tabs.forEach(t  => t.classList.toggle('active', t.id === tabId));
      const isEv = tabId === 'eventsTab';
      evCtrl.style.display = isEv ? 'flex' : 'none';
      sdStat.style.display = isEv ? 'none' : 'flex';
    }

    pills.forEach(p => p.addEventListener('click', () => switchTab(p.dataset.tab)));

    // Initial state
    evCtrl.style.display = 'flex';
    sdStat.style.display = 'none';
  })();
</script>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EVENTS JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
  // â”€â”€â”€ CONSTANTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const JSON_PATH   = "file/kz-events-backup.json";
  const STORAGE_KEY = "kz_events_v2";

  // â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let events       = [];
  let updateMode   = false;
  let editingIndex = null;
  let filterStatus = "all";
  let filterWinner = "";
  let filterMedalist = "";
  let searchQuery  = "";
  let sortMode     = "newest";

  // â”€â”€â”€ DOM HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const g  = id => document.getElementById(id);
  const st = v  => (v ?? "").toString();

  // â”€â”€â”€ PERSISTENCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function loadLocal() {
    try {
      const d = JSON.parse(localStorage.getItem(STORAGE_KEY));
      return Array.isArray(d) ? d : [];
    } catch { return []; }
  }
  function saveLocal() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
  }

  // â”€â”€â”€ STATUS CHIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setStatus(state, text) {
    g("statusDot").className   = "s-dot " + state;
    g("statusLabel").textContent = text;
  }

  // â”€â”€â”€ FETCH JSON FILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function fetchJSON() {
    setStatus("loading", "Loadingâ€¦");
    try {
      const res  = await fetch(JSON_PATH + "?_=" + Date.now());
      if (!res.ok) throw new Error("HTTP " + res.status);
      const data = await res.json();
      if (!Array.isArray(data)) throw new Error("Not a valid array");
      events = data;
      saveLocal();
      setStatus("ok", "JSON loaded");
      return true;
    } catch (err) {
      setStatus("err", "File not found");
      console.info("[Events] " + JSON_PATH + " â€”", err.message);
      return false;
    }
  }

  // â”€â”€â”€ EXPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function exportJSON() {
    const blob = new Blob([JSON.stringify(events, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "kz-events-backup.json";
    a.click();
    URL.revokeObjectURL(a.href);
    showFeedback("âœ“ Exported kz-events-backup.json â€” place it in file/ and push to GitHub.", "ok");
  }

  // â”€â”€â”€ IMPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openImport() {
    const inp = document.createElement("input");
    inp.type = "file"; inp.accept = "application/json";
    inp.onchange = () => {
      const f = inp.files[0];
      if (!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          if (!Array.isArray(data)) throw new Error("invalid");
          events = data;
          saveLocal();
          updateStats(); render();
          showFeedback("âœ“ Imported. Export and push to file/ to make it permanent.", "ok");
          setStatus("ok", "Imported");
        } catch { showFeedback("Import failed: invalid JSON file.", "error"); }
      };
      reader.readAsText(f);
    };
    inp.click();
  }

  // â”€â”€â”€ FORM FEEDBACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showFeedback(msg, type) {
    const el = g("formFeedback");
    el.textContent   = msg || "";
    el.className     = "form-feedback" + (type ? " " + type : "");
    el.style.display = msg ? "" : "none";
  }

  // â”€â”€â”€ STATUS FIELDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function toggleStatusFields() {
    const live = g("status").value === "Live";
    ["liveOnlyA","liveOnlyB"].forEach(id => g(id).classList.toggle("hidden", !live));
    ["finishedOnlyA","finishedOnlyA2","finishedOnlyB"].forEach(id => g(id).classList.toggle("hidden", live));
  }

  // â”€â”€â”€ FLAG / LOGO PREVIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setFlagPreview(url) {
    const img = g("flagPreview"), em = g("flagEmoji");
    if (url) { img.src = url; img.style.display = "block"; em.style.display = "none"; }
    else     { img.style.display = "none"; img.removeAttribute("src"); em.style.display = ""; }
  }

  async function previewFile(inputId, previewId) {
    const file = g(inputId).files[0];
    const prev = g(previewId);
    if (file) {
      const url = await fileToDataURL(file);
      prev.src = url; prev.style.display = "block";
    } else {
      prev.style.display = "none";
    }
  }

  g("eventLogo").addEventListener("change",  () => previewFile("eventLogo",  "eventLogoPreview"));
  g("trophyLogo").addEventListener("change", () => previewFile("trophyLogo", "trophyLogoPreview"));
  g("flagUpload").addEventListener("change", async () => {
    setFlagPreview(await fileToDataURL(g("flagUpload").files[0]));
  });

  // â”€â”€â”€ UTILITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function isTyping(t) {
    if (!t) return false;
    return ["input","textarea","select"].includes((t.tagName||"").toLowerCase()) || t.isContentEditable;
  }

  function fileToDataURL(file) {
    return new Promise(resolve => {
      if (!file) return resolve("");
      const r = new FileReader();
      r.onload = () => resolve(r.result || "");
      r.onerror = () => resolve("");
      r.readAsDataURL(file);
    });
  }

  function starsHTML(n) {
    const v = Math.max(0, Math.min(5, Number(n) || 0));
    return `<span class="stars-row">${Array.from({length:5},(_,i) =>
      `<span class="star${i<v?" on":""}"">â˜…</span>`).join("")}</span>`;
  }

  // â”€â”€â”€ CLEAR / MODES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function clearForm() {
    ["name","link","time","prizePool","teams","location","importance",
     "stage","m1","m2","m3","winnerTeam","runnerUpTeam","mvp","evp","vp"]
      .forEach(id => g(id).value = "");
    g("status").value = "Finished";
    g("major").value  = "false";
    ["flagUpload","eventLogo","trophyLogo"].forEach(id => g(id).value = "");
    g("eventLogoPreview").style.display  = "none";
    g("trophyLogoPreview").style.display = "none";
    setFlagPreview("");
    showFeedback("");
    toggleStatusFields();
  }

  function enterAddMode() {
    editingIndex = null;
    g("panelTitle").textContent = "Add New Event";
    g("submitBtn").textContent  = "ï¼‹ Add Event";
    g("cancelEditBtn").classList.add("hidden");
    showFeedback("");
    clearForm();
  }

  function enterEditMode(idx) {
    const ev = events[idx];
    editingIndex = idx;
    g("panelTitle").textContent = "Update Event";
    g("submitBtn").textContent  = "âœ“ Save Update";
    g("cancelEditBtn").classList.remove("hidden");

    g("name").value         = st(ev.name);
    g("link").value         = st(ev.driveLink);
    g("status").value       = st(ev.status || "Finished");
    g("time").value         = st(ev.time);
    g("prizePool").value    = st(ev.prizePool);
    g("teams").value        = st(ev.teams);
    g("location").value     = st(ev.location);
    g("importance").value   = st(ev.importance);
    g("major").value        = ev.major ? "true" : "false";
    g("stage").value        = st(ev.stage);
    g("m1").value = st((ev.nextMatches||[])[0]||"");
    g("m2").value = st((ev.nextMatches||[])[1]||"");
    g("m3").value = st((ev.nextMatches||[])[2]||"");
    g("winnerTeam").value   = st(ev.winnerTeam);
    g("runnerUpTeam").value = st(ev.runnerUpTeam);
    g("mvp").value = st(ev.mvp);
    g("evp").value = st(ev.evp);
    g("vp").value  = st(ev.vp);

    setFlagPreview(ev.flagImage || "");
    toggleStatusFields();
    showFeedback("Upload new logo/flag only if you want to replace the current one.", "info");
    g("addPanel").classList.remove("hidden");
    g("toggleAddBtn").classList.add("primary");
  }

  // â”€â”€â”€ SUBMIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function handleSubmit() {
    const name = g("name").value.trim();
    const link = g("link").value.trim();
    if (!name)                                return showFeedback("Event name is required.", "error");
    if (!link || !/^https?:\/\//i.test(link)) return showFeedback("A valid https link is required.", "error");

    const isLive        = g("status").value === "Live";
    const newEventLogo  = await fileToDataURL(g("eventLogo").files[0]);
    const newTrophyLogo = await fileToDataURL(g("trophyLogo").files[0]);
    const newFlagImage  = await fileToDataURL(g("flagUpload").files[0]);
    const nextMatches   = [g("m1").value.trim(), g("m2").value.trim(), g("m3").value.trim()]
                            .filter(Boolean).slice(0,3);

    const payload = {
      eventLogo:    newEventLogo,
      trophyLogo:   newTrophyLogo,
      flagImage:    newFlagImage,
      name,
      driveLink:    link,
      status:       g("status").value,
      time:         g("time").value.trim() || (isLive ? "Live" : ""),
      prizePool:    g("prizePool").value.trim(),
      teams:        Number(g("teams").value) || 0,
      location:     g("location").value.trim(),
      importance:   Math.max(1, Math.min(5, Number(g("importance").value) || 1)),
      major:        g("major").value === "true",
      stage:        isLive ? g("stage").value.trim() : "",
      nextMatches:  isLive ? nextMatches : [],
      winnerTeam:   isLive ? "" : g("winnerTeam").value.trim(),
      runnerUpTeam: isLive ? "" : g("runnerUpTeam").value.trim(),
      mvp:          isLive ? "" : g("mvp").value.trim(),
      evp:          isLive ? "" : g("evp").value.trim(),
      vp:           isLive ? "" : g("vp").value.trim(),
      addedAt:      editingIndex === null
                      ? Date.now()
                      : (events[editingIndex].addedAt || Date.now()),
    };

    if (editingIndex === null) {
      events.unshift(payload);
    } else {
      const old = events[editingIndex];
      payload.eventLogo  = payload.eventLogo  || old.eventLogo  || "";
      payload.trophyLogo = payload.trophyLogo || old.trophyLogo || "";
      payload.flagImage  = payload.flagImage  || old.flagImage  || "";
      events[editingIndex] = payload;
    }

    saveLocal();
    updateStats();
    render();
    showFeedback("âœ“ Saved locally. Export the JSON and push to file/ to persist permanently.", "ok");
    if (editingIndex === null) clearForm();
  }

  // â”€â”€â”€ DELETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function deleteEvent(idx) {
    if (!confirm("Delete this event?")) return;
    events.splice(idx, 1);
    if (editingIndex === idx) enterAddMode();
    saveLocal();
    updateStats();
    render();
  }

  // â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function parsePrize(s) {
    if (!s) return 0;
    const n = parseFloat(s.replace(/[^0-9.]/g, ""));
    if (isNaN(n)) return 0;
    const l = s.toLowerCase();
    if (l.includes("m")) return n * 1e6;
    if (l.includes("k")) return n * 1e3;
    return n;
  }

  function updateStats() {
    g("statTotal").textContent  = events.length;
    g("statLive").textContent   = events.filter(e => e.status === "Live").length;
    g("statMajors").textContent = events.filter(e => e.major).length;
    const tp = events.reduce((a,e) => a + parsePrize(e.prizePool), 0);
    g("statPrize").textContent  = tp === 0 ? "â€”"
      : tp >= 1e6 ? "$" + (tp/1e6).toFixed(1) + "M"
      : tp >= 1e3 ? "$" + (tp/1e3).toFixed(0) + "K"
      : "$" + tp.toFixed(0);
    updateWinnerFilter();
    updateMedalistFilter();
  }

  // â”€â”€â”€ ANALYSIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openAnalysis() {
    if (!events.length) { alert("No events to analyze yet."); return; }
    const total      = events.length;
    const live       = events.filter(e => e.status === "Live").length;
    const majors     = events.filter(e => e.major).length;
    const avgImp     = (events.reduce((a,e) => a + (Number(e.importance)||0), 0) / total).toFixed(1);
    const tp         = events.reduce((a,e) => a + parsePrize(e.prizePool), 0);
    const totalTeams = events.reduce((a,e) => a + (Number(e.teams)||0), 0);

    const tally = (key) => events.reduce((m,e) => {
      if (e[key]) m[e[key]] = (m[e[key]]||0) + 1;
      return m;
    }, {});
    const top = (obj, n) => Object.entries(obj).sort((a,b)=>b[1]-a[1]).slice(0,n);

    const winners = top(tally("winnerTeam"), 5);
    const mvps    = top(tally("mvp"), 5);
    const locMap  = {};
    events.filter(e => e.location).forEach(e => {
      const k = e.location.split(",").pop()?.trim() || e.location;
      locMap[k] = (locMap[k]||0) + 1;
    });
    const topLoc  = top(locMap, 1)[0];
    const richest = events.filter(e => parsePrize(e.prizePool) > 0)
                          .sort((a,b) => parsePrize(b.prizePool) - parsePrize(a.prizePool))[0];
    const maxW    = winners.length ? winners[0][1] : 1;

    const notes = [];
    if (live)    notes.push({ i:"ğŸ”´", t:`${live} event${live>1?"s":""} currently live.` });
    if (majors)  notes.push({ i:"ğŸ‘‘", t:`${majors} Major${majors>1?"s":""} = ${((majors/total)*100).toFixed(0)}% of all events.` });
    if (+avgImp >= 4)     notes.push({ i:"â­", t:`High-tier focus â€” avg importance ${avgImp}/5.` });
    else if (+avgImp <= 2) notes.push({ i:"ğŸ“‰", t:`Low avg importance (${avgImp}/5) â€” consider adding bigger events.` });
    else                   notes.push({ i:"ğŸ“Š", t:`Balanced registry â€” avg importance ${avgImp}/5.` });
    if (winners.length && winners[0][1] > 1)
      notes.push({ i:"ğŸ¥‡", t:`${winners[0][0]} leads with ${winners[0][1]} wins tracked.` });
    if (tp > 0)  notes.push({ i:"ğŸ’°", t:`Total prize pool on record: $${(tp/1e6).toFixed(2)}M.` });
    if (topLoc)  notes.push({ i:"ğŸ“", t:`Most hosted region: ${topLoc[0]} (${topLoc[1]} event${topLoc[1]>1?"s":""}).` });
    if (richest) notes.push({ i:"ğŸ¯", t:`Richest event: ${richest.name} â€” ${richest.prizePool}.` });

    g("analysisContent").innerHTML = `
      <div class="a-section">
        <div class="a-section-title">Overview</div>
        <div class="a-grid">
          <div class="a-hl"><div class="a-hl-val">${total}</div><div class="a-hl-desc">Total events</div></div>
          <div class="a-hl"><div class="a-hl-val" style="color:#34d399">${live}</div><div class="a-hl-desc">Currently live</div></div>
          <div class="a-hl"><div class="a-hl-val" style="color:#fbbf24">${majors}</div><div class="a-hl-desc">Major events</div></div>
          <div class="a-hl"><div class="a-hl-val" style="color:#a78bfa">${totalTeams}</div><div class="a-hl-desc">Teams (total slots)</div></div>
        </div>
      </div>
      ${winners.length ? `
      <div class="a-section">
        <div class="a-section-title">ğŸ† Top Winners</div>
        ${winners.map(([t,w]) => `
          <div class="a-bar-row">
            <div class="a-bar-label"><strong>${t}</strong><span>${w} win${w>1?"s":""}</span></div>
            <div class="a-bar-track"><div class="a-bar-fill" style="width:${Math.round(w/maxW*100)}%"></div></div>
          </div>`).join("")}
      </div>` : ""}
      ${mvps.length ? `
      <div class="a-section">
        <div class="a-section-title">â­ Top MVPs</div>
        ${mvps.map(([p,c]) => `
          <div class="a-item">
            <span class="a-icon">ğŸ®</span>
            <span><strong>${p}</strong> â€” MVP in ${c} event${c>1?"s":""}</span>
          </div>`).join("")}
      </div>` : ""}
      <div class="a-section">
        <div class="a-section-title">ğŸ§  Intelligence Notes</div>
        ${notes.map(n => `
          <div class="a-item"><span class="a-icon">${n.i}</span><span>${n.t}</span></div>`).join("")}
      </div>`;

    g("analysisModal").classList.add("open");
  }

  // â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getFiltered() {
    let list = [...events];
    if (filterStatus === "major")        list = list.filter(e => e.major);
    else if (filterStatus !== "all")     list = list.filter(e => e.status === filterStatus);
    if (filterWinner) {
      list = list.filter(e => (e.winnerTeam||"").toLowerCase() === filterWinner.toLowerCase());
    }
    if (filterMedalist) {
      const m = filterMedalist.toLowerCase();
      list = list.filter(e =>
        (e.mvp||"").toLowerCase() === m ||
        (e.evp||"").toLowerCase() === m ||
        (e.vp||"").toLowerCase() === m
      );
    }
    if (searchQuery) {
      const q = searchQuery.toLowerCase();
      list = list.filter(e => [e.name, e.location, e.winnerTeam, e.mvp]
        .some(v => (v||"").toLowerCase().includes(q)));
    }
    if (sortMode === "oldest")           list.sort((a,b) => (a.addedAt||0) - (b.addedAt||0));
    else if (sortMode === "importance")  list.sort((a,b) => (b.importance||0) - (a.importance||0));
    else if (sortMode === "az")          list.sort((a,b) => (a.name||"").localeCompare(b.name||""));
    else                                 list.sort((a,b) => (b.addedAt||0) - (a.addedAt||0));
    return list;
  }

  function render() {
    const listEl = g("eventsList");
    listEl.innerHTML = "";
    const list   = getFiltered();
    const idxMap = new Map(events.map((ev,i) => [ev,i]));

    if (!list.length) {
      listEl.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ğŸ“­</div>
          <div class="empty-title">${events.length === 0 ? "No Events Yet" : "No Results"}</div>
          <div class="empty-sub">${events.length === 0
            ? "Add an event above or place kz-events-backup.json in file/ and reload."
            : "Try adjusting your search or filters."}</div>
        </div>`;
      return;
    }

    list.forEach(ev => {
      const idx    = idxMap.get(ev);
      const isLive = ev.status === "Live";
      const ac     = ev.major ? "rgba(251,191,36,.7)" : isLive ? "rgba(34,197,94,.7)" : "rgba(0,212,255,.5)";

      const card   = document.createElement("article");
      card.className = `event-card${isLive?" is-live":""}${ev.major?" is-major":""}`;

      const locText = st(ev.location) || "â€”";
      const locHTML = ev.flagImage
        ? `<img class="flag-mini" src="${ev.flagImage}" alt="flag">${locText}`
        : locText;

      const liveBlock = isLive ? `
        <div class="live-block">
          <div class="live-block-head">
            <div class="live-block-title">Live Details</div>
            <span class="pill live">Stage: ${st(ev.stage)||"â€”"}</span>
          </div>
          <div class="match-list">
            ${(ev.nextMatches||[]).slice(0,3).map(m => {
              const p = st(m).split(" â€“ ");
              return `<div class="match-row"><span>${p[0]||st(m)}</span><span>${p.slice(1).join(" â€“ ")}</span></div>`;
            }).join("") || `<div style="font-size:12px;color:var(--muted);padding:4px 0;">No matches scheduled.</div>`}
          </div>
        </div>` : "";

      const finishedBlock = !isLive ? `
        <div class="finished-block">
          <div class="winner-row">
            <span class="winner-label">Winner</span>
            <span class="winner-name">${st(ev.winnerTeam)||"â€”"}</span>
            ${ev.trophyLogo && ev.winnerTeam ? `<img class="trophy-img" src="${ev.trophyLogo}" alt="trophy">` : ""}
          </div>
          <div class="runner-up-row"><strong>2nd place:</strong> ${st(ev.runnerUpTeam)||"â€”"}</div>
          <div class="highlights-grid">
            <div class="hl-chip"><strong>MVP</strong>${st(ev.mvp)||"â€”"}</div>
            <div class="hl-chip"><strong>EVP</strong>${st(ev.evp)||"â€”"}</div>
            <div class="hl-chip"><strong>VP</strong>${st(ev.vp)||"â€”"}</div>
          </div>
        </div>` : "";

      const editBar = updateMode ? `
        <div class="edit-bar">
          <button class="btn primary" data-action="edit"   data-idx="${idx}">âœ Edit</button>
          <button class="btn danger"  data-action="delete" data-idx="${idx}">âœ• Delete</button>
        </div>` : "";

      card.innerHTML = `
        <div class="card-bg" style="background-image:url('${ev.eventLogo||""}')"></div>
        <div class="card-accent" style="--ac:${ac}"></div>
        <div class="card-inner">
          <div class="logo-box">${ev.eventLogo ? `<img src="${ev.eventLogo}" alt="${st(ev.name)}">` : `<div class="logo-ph">ğŸ“…</div>`}</div>
          <div>
            <div class="ev-head">
              <div class="ev-name-row">
                <a class="ev-name" href="${st(ev.driveLink)}" target="_blank" rel="noopener">${st(ev.name)}</a>
                ${isLive ? `<span class="pill live">Live</span>` : ev.time ? `<span class="pill finished">${st(ev.time)}</span>` : ""}
                ${ev.major ? `<span class="pill major">ğŸ‘‘ Major</span>` : ""}
              </div>
              ${starsHTML(ev.importance)}
            </div>
            <div class="ev-meta">
              <div class="meta-kv"><div class="meta-k">Prize Pool</div><div class="meta-v">${st(ev.prizePool)||"â€”"}</div></div>
              <div class="meta-kv"><div class="meta-k">Teams</div><div class="meta-v">${st(ev.teams)||"0"}</div></div>
              <div class="meta-kv"><div class="meta-k">Location</div><div class="meta-v">${locHTML}</div></div>
            </div>
            ${liveBlock}${finishedBlock}${editBar}
          </div>
        </div>`;

      listEl.appendChild(card);
    });

    listEl.querySelectorAll("button[data-action]").forEach(btn => {
      btn.addEventListener("click", () => {
        const idx = Number(btn.dataset.idx);
        if (btn.dataset.action === "edit")   enterEditMode(idx);
        if (btn.dataset.action === "delete") deleteEvent(idx);
      });
    });
  }

  // â”€â”€â”€ WIRE CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  g("status").addEventListener("change", toggleStatusFields);
  g("submitBtn").addEventListener("click", handleSubmit);
  g("cancelEditBtn").addEventListener("click", () => enterAddMode());
  g("clearAllBtn").addEventListener("click",   () => clearForm());

  g("updateBtn").addEventListener("click", () => {
    updateMode = !updateMode;
    g("updateBtn").textContent = `âœ Update: ${updateMode ? "ON" : "OFF"}`;
    g("updateBtn").classList.toggle("active-on", updateMode);
    if (!updateMode) enterAddMode();
    render();
  });

  g("toggleAddBtn").addEventListener("click", () => {
    const panel = g("addPanel");
    panel.classList.toggle("hidden");
    g("toggleAddBtn").classList.toggle("primary", !panel.classList.contains("hidden"));
  });

  g("analysisBtn").addEventListener("click", openAnalysis);
  g("closeAnalysis").addEventListener("click", () => g("analysisModal").classList.remove("open"));
  g("analysisModal").addEventListener("click", e => {
    if (e.target === g("analysisModal")) g("analysisModal").classList.remove("open");
  });

  g("exportBtn").addEventListener("click", exportJSON);
  g("importBtn").addEventListener("click", openImport);

  g("reloadBtn").addEventListener("click", async () => {
    const ok = await fetchJSON();
    if (ok) {
      updateStats(); render();
      showFeedback("âœ“ JSON reloaded from file/kz-events-backup.json.", "ok");
    } else {
      showFeedback("Could not load file/kz-events-backup.json â€” make sure the file exists in the file/ folder and is pushed to GitHub.", "error");
    }
  });

  document.querySelectorAll(".filter-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      filterStatus = btn.dataset.filter;
      render();
    });
  });

  g("searchBox").addEventListener("input",   e => { searchQuery = e.target.value.trim(); render(); });
  g("sortSelect").addEventListener("change", e => { sortMode = e.target.value; render(); });
  g("winnerFilter").addEventListener("change", e => {
    filterWinner = e.target.value;
    e.target.classList.toggle("has-selection", filterWinner !== "");
    render();
  });
  g("medalistFilter").addEventListener("change", e => {
    filterMedalist = e.target.value;
    e.target.classList.toggle("has-selection", filterMedalist !== "");
    render();
  });

  function updateWinnerFilter() {
    const select = g("winnerFilter");
    const currentValue = select.value;
    const winners = [...new Set(
      events.map(e => (e.winnerTeam || "").trim()).filter(w => w.length > 0)
    )].sort((a, b) => a.localeCompare(b));
    select.innerHTML = '<option value="">ğŸ† All Winners</option>';
    winners.forEach(w => {
      const opt = document.createElement("option");
      opt.value = w; opt.textContent = w;
      select.appendChild(opt);
    });
    if (winners.includes(currentValue)) select.value = currentValue;
    else { select.value = ""; filterWinner = ""; }
    select.classList.toggle("has-selection", select.value !== "");
  }

  function updateMedalistFilter() {
    const select = g("medalistFilter");
    const currentValue = select.value;
    const medalists = [...new Set(
      events.flatMap(e => [(e.mvp||"").trim(),(e.evp||"").trim(),(e.vp||"").trim()]).filter(m => m.length > 0)
    )].sort((a, b) => a.localeCompare(b));
    select.innerHTML = '<option value="">ğŸ–ï¸ All Medalists</option>';
    medalists.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m; opt.textContent = m;
      select.appendChild(opt);
    });
    if (medalists.includes(currentValue)) select.value = currentValue;
    else { select.value = ""; filterMedalist = ""; }
    select.classList.toggle("has-selection", select.value !== "");
  }

  document.addEventListener("keydown", e => {
    if (e.ctrlKey && e.shiftKey && ["a","A"].includes(e.key)) { e.preventDefault(); g("toggleAddBtn").click(); }
    if (e.ctrlKey && e.shiftKey && ["s","S"].includes(e.key)) { e.preventDefault(); exportJSON(); }
    if (e.ctrlKey && e.shiftKey && ["o","O"].includes(e.key)) { e.preventDefault(); openImport(); }
    if (e.key === "Escape") g("analysisModal").classList.remove("open");
    if (e.key === "0" && !isTyping(e.target)) window.location.href = "index.html";
  });

  // â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function boot() {
    events = loadLocal();
    toggleStatusFields();
    enterAddMode();
    updateStats();
    render();
    const ok = await fetchJSON();
    if (ok) { updateStats(); render(); }
  }

  boot();
</script>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SEEDING / MATCH GENERATOR JAVASCRIPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
  const RANKING_PATH = 'file/ranking.xlsx';

  const sdEls = {
    loadState:     document.getElementById('loadState'),
    fallbackBox:   document.getElementById('fallbackBox'),
    manualInput:   document.getElementById('manualInput'),
    useManual:     document.getElementById('useManual'),
    manualStatus:  document.getElementById('manualStatus'),
    filter:        document.getElementById('sdFilter'),
    regionFilter:  document.getElementById('regionFilter'),
    tierFilter:    document.getElementById('tierFilter'),
    bulkNames:     document.getElementById('bulkNames'),
    applyBulk:     document.getElementById('applyBulk'),
    selectAll:     document.getElementById('selectAll'),
    clearSel:      document.getElementById('clearSel'),
    selCount:      document.getElementById('selCount'),
    listCount:     document.getElementById('listCount'),
    teamList:      document.getElementById('teamList'),
    generate:      document.getElementById('sdGenerate'),
    regenerate:    document.getElementById('sdRegenerate'),
    analyzeBtn:    document.getElementById('sdAnalyzeBtn'),
    copy:          document.getElementById('sdCopy'),
    download:      document.getElementById('sdDownload'),
    genInfo:       document.getElementById('genInfo'),
    selectedTable: document.getElementById('selectedTable'),
    matchups:      document.getElementById('matchups'),
    aiPanel:       document.getElementById('aiPanel'),
    aiStats:       document.getElementById('aiStats'),
    aiMatchAnalysis: document.getElementById('aiMatchAnalysis'),
    aiInsights:    document.getElementById('aiInsights'),
    closeAI:       document.getElementById('closeAI'),
    topStatusDot:  document.getElementById('topStatusDot'),
    topStatusText: document.getElementById('topStatusText'),
  };

  let ranking = [];
  let sdSelected = new Set();
  let sdLastOutputText = '';
  let sdLastMatches = [];
  let sdLastTeams = [];

  function sdNormalizeStr(s){ return (s ?? '').toString().trim(); }

  function sdParseNumber(v){
    if (typeof v === 'number') return v;
    if (v === null || v === undefined) return 0;
    const s = v.toString().replace(/\s/g,'').replace(',','.');
    const n = Number(s);
    return Number.isFinite(n) ? n : 0;
  }

  function sdSortRanking(arr){
    return arr.slice().sort((a,b)=>{
      if (b.points !== a.points) return b.points - a.points;
      return a.team.localeCompare(b.team,'en',{sensitivity:'base'});
    });
  }

  function sdIsTypingTarget(el){
    if (!el) return false;
    const tag = (el.tagName||'').toLowerCase();
    return tag==='input'||tag==='textarea'||tag==='select'||el.isContentEditable;
  }

  function sdEscapeHtml(str){
    return (str||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  }

  function sdSetTopStatus(ok, text){
    sdEls.topStatusDot.className = 'status-dot-sd' + (ok ? '' : ' red');
    sdEls.topStatusText.textContent = text;
  }

  function sdSetLoadedState(ok, msg){
    sdEls.loadState.className = 'load-state ' + (ok ? 'ok' : 'err');
    sdEls.loadState.innerHTML = (ok ? 'âœ“ ' : 'âœ— ') + sdEscapeHtml(msg);
    sdSetTopStatus(ok, ok ? `${ranking.length} teams loaded` : 'Load error');
  }

  function sdUpdateSelCount(){ sdEls.selCount.textContent = `${sdSelected.size} selected`; }

  function sdGetTierClass(tier){
    if (!tier) return '';
    const t = tier.toString().toLowerCase();
    if (t.includes('1')) return 't1';
    if (t.includes('2')) return 't2';
    return 't3';
  }

  function sdPopulateFilters(){
    const regions = [...new Set(ranking.map(r=>r.region).filter(Boolean))].sort();
    const tiers = [...new Set(ranking.map(r=>r.tier).filter(Boolean))].sort();
    sdEls.regionFilter.innerHTML = '<option value="">All Regions</option>' + regions.map(r=>`<option>${sdEscapeHtml(r)}</option>`).join('');
    sdEls.tierFilter.innerHTML = '<option value="">All Tiers</option>' + tiers.map(t=>`<option>${sdEscapeHtml(t)}</option>`).join('');
  }

  function sdRenderTeamList(){
    const f = sdNormalizeStr(sdEls.filter.value).toLowerCase();
    const reg = sdEls.regionFilter.value;
    const tier = sdEls.tierFilter.value;
    const frag = document.createDocumentFragment();
    let visible = 0;

    for (const row of ranking){
      if (f && !row.team.toLowerCase().includes(f)) continue;
      if (reg && row.region !== reg) continue;
      if (tier && row.tier !== tier) continue;
      visible++;

      const item = document.createElement('div');
      item.className = 'team-item';

      const left = document.createElement('div');
      left.className = 'team-left';

      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.checked = sdSelected.has(row.team);
      cb.addEventListener('change', ()=>{
        if (cb.checked) sdSelected.add(row.team); else sdSelected.delete(row.team);
        sdUpdateSelCount();
      });

      const info = document.createElement('div');
      const regionHtml = row.region ? `<span class="region-badge">${sdEscapeHtml(row.region)}</span>` : '';
      const tierHtml = row.tier ? `<span class="tier-badge ${sdGetTierClass(row.tier)}">${sdEscapeHtml(row.tier)}</span>` : '';
      info.innerHTML = `<div class="team-name">${sdEscapeHtml(row.team)}</div><div class="team-pts">${row.points.toFixed ? row.points.toFixed(2) : row.points} pts ${regionHtml} ${tierHtml}</div>`;

      left.appendChild(cb);
      left.appendChild(info);

      const seed = document.createElement('div');
      seed.className = 'seed-badge';
      seed.textContent = `#${row.seed}`;

      item.appendChild(left);
      item.appendChild(seed);
      frag.appendChild(item);
    }

    sdEls.teamList.innerHTML = '';
    sdEls.teamList.appendChild(frag);
    sdEls.listCount.textContent = `${visible} of ${ranking.length} teams`;
    if (visible === 0){
      sdEls.teamList.innerHTML = '<div style="color:var(--muted);font-family:var(--font-m);font-size:12px;padding:12px;">No teams match this filter.</div>';
    }
  }

  function sdParseManualLines(text){
    const lines = (text||'').split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
    const out = [];
    for (const line of lines){
      const parts = line.includes(';') ? line.split(';') : line.split(',');
      if (parts.length < 2) continue;
      const team = sdNormalizeStr(parts[0]);
      const points = sdParseNumber(parts.slice(1).join('.'));
      if (team) out.push({team, points, tier:'', region:''});
    }
    return out;
  }

  function sdApplyBulkNames(){
    const names = (sdEls.bulkNames.value||'').split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    const setLower = new Set(names.map(n=>n.toLowerCase()));
    let matched = 0;
    for (const row of ranking){
      if (setLower.has(row.team.toLowerCase()) && !sdSelected.has(row.team)){
        sdSelected.add(row.team); matched++;
      }
    }
    sdUpdateSelCount(); sdRenderTeamList();
    sdEls.genInfo.textContent = matched ? `âœ“ Selected ${matched} matching name(s).` : 'âš  No pasted name matched the ranking.';
  }

  function sdSelectAllVisible(){
    const f = sdNormalizeStr(sdEls.filter.value).toLowerCase();
    const reg = sdEls.regionFilter.value;
    const tier = sdEls.tierFilter.value;
    for (const row of ranking){
      if (f && !row.team.toLowerCase().includes(f)) continue;
      if (reg && row.region !== reg) continue;
      if (tier && row.tier !== tier) continue;
      sdSelected.add(row.team);
    }
    sdUpdateSelCount(); sdRenderTeamList();
    sdEls.genInfo.textContent = `âœ“ Selected all visible teams (${sdSelected.size} total).`;
  }

  function sdClearSelection(){
    sdSelected.clear(); sdUpdateSelCount(); sdRenderTeamList(); sdEls.genInfo.textContent = '';
    sdEls.aiPanel.classList.remove('visible');
  }

  function sdGetSelectedTeamsSorted(){
    return sdSortRanking(ranking.filter(r=>sdSelected.has(r.team)));
  }

  function sdRenderSelectedTable(teams){
    let txt = '';
    teams.forEach((t,i)=>{
      txt += `${String(i+1).padStart(2,'0')}  ${t.team.padEnd(28,' ')}  ${(t.points+'').padStart(10,' ')}\n`;
    });
    sdEls.selectedTable.textContent = txt || 'â€”';
  }

  function sdRenderTeamBox(seed, t, wine){
    const box = document.createElement('div');
    box.className = 'team-box' + (t?'' : ' bye') + (wine ? ' wine' : '');
    if (t){
      box.innerHTML = `<span class="tname">#${seed} ${sdEscapeHtml(t.team)}</span><div class="tinfo">${t.points.toFixed ? t.points.toFixed(2) : t.points} pts${t.region ? ' Â· ' + sdEscapeHtml(t.region) : ''}</div>`;
    } else {
      box.innerHTML = `<span class="tname">#${seed} BYE</span><div class="tinfo">no opponent</div>`;
    }
    return box;
  }

  function sdRenderMatches(matches){
    sdEls.matchups.innerHTML = '';
    if (!matches.length){
      sdEls.matchups.innerHTML = '<div style="color:var(--muted);font-family:var(--font-m);font-size:12px;padding:8px;">No matches to show.</div>';
      return;
    }
    const frag = document.createDocumentFragment();
    matches.forEach((m,idx)=>{
      const div = document.createElement('div');
      div.className = 'match-card';
      div.style.animationDelay = `${idx * 40}ms`;

      const hdr = document.createElement('div');
      hdr.className = 'match-hdr';
      hdr.innerHTML = `<strong>Match ${idx+1}</strong><span>RANDOMIZED ORDER</span>`;

      const body = document.createElement('div');
      body.className = 'match-body';
      body.appendChild(sdRenderTeamBox(m.leftSeed, m.left, m.wineSide==='left'));
      const vs = document.createElement('div');
      vs.className = 'vs-badge';
      vs.textContent = 'VS';
      body.appendChild(vs);
      body.appendChild(sdRenderTeamBox(m.rightSeed, m.right, m.wineSide==='right'));

      div.appendChild(hdr);
      div.appendChild(body);
      frag.appendChild(div);
    });
    sdEls.matchups.appendChild(frag);
  }

  function sdBuildSeededPairs(teams){
    const n = teams.length;
    const pairs = [];
    for (let i=0; i<Math.ceil(n/2); i++){
      const strong = teams[i];
      const weakIndex = n - 1 - i;
      const weak = weakIndex > i ? teams[weakIndex] : null;
      pairs.push({ strongSeed:i+1, weakSeed:weakIndex+1, strong, weak });
    }
    return pairs;
  }

  function sdShuffleInPlace(arr){
    for (let i=arr.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
    return arr;
  }

  function sdBuildMatchesRandomSidesAndWine(pairs){
    const matches = pairs.map(p=>{
      const swap = p.weak && Math.random()<0.5;
      const left = swap ? p.weak : p.strong;
      const right = swap ? p.strong : p.weak;
      const leftSeed = swap ? p.weakSeed : p.strongSeed;
      const rightSeed = swap ? p.strongSeed : p.weakSeed;
      const wineSide = (left && right) ? (Math.random()<0.5 ? 'left' : 'right') : null;
      return { left, right, leftSeed, rightSeed, wineSide };
    });
    return sdShuffleInPlace(matches);
  }

  function sdBuildOutputText(teams, matches){
    const lines = [`Generated Matches (seeded strong vs weak) â€” ${teams.length} teams`, ''];
    matches.forEach((m,idx)=>{
      const L = m.left ? `${m.left.team} (${m.left.points})` : 'BYE';
      const R = m.right ? `${m.right.team} (${m.right.points})` : 'BYE';
      const wineNote = m.wineSide ? ` [wine: ${m.wineSide}]` : '';
      lines.push(`Match ${idx+1}: #${m.leftSeed} ${L}  vs  #${m.rightSeed} ${R}${wineNote}`);
    });
    return lines.join('\n');
  }

  // â”€â”€ AI ANALYSIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function sdBuildAIAnalysis(teams, matches){
    const realMatches = matches.filter(m => m.left && m.right);
    const pointsDiffs = realMatches.map(m => Math.abs(m.left.points - m.right.points));
    const maxDiff = Math.max(...pointsDiffs);
    const minDiff = Math.min(...pointsDiffs);
    const avgDiff = pointsDiffs.reduce((a,b)=>a+b,0) / (pointsDiffs.length || 1);
    const topTeam = teams[0];
    const bottomTeam = teams[teams.length-1];
    const totalSpread = teams.length > 1 ? topTeam.points - bottomTeam.points : 0;

    const tierCounts = {};
    teams.forEach(t=>{ const tier = t.tier || 'Unknown'; tierCounts[tier] = (tierCounts[tier]||0)+1; });

    const regionCounts = {};
    teams.forEach(t=>{ const r = t.region || 'Unknown'; regionCounts[r] = (regionCounts[r]||0)+1; });

    const upsetThreshold = totalSpread * 0.15;
    const tossupThreshold = totalSpread * 0.07;

    const stats = [
      { label:'Total Matches', value: matches.length, sub: `${matches.filter(m=>!m.right).length} BYE(s)`, class:'' },
      { label:'Avg Point Gap', value: avgDiff.toFixed(1), sub: 'per match', class:'' },
      { label:'Largest Gap',   value: maxDiff.toFixed(1), sub: 'most predictable', class:'' },
      { label:'Smallest Gap',  value: minDiff.toFixed(1), sub: 'closest match', class:'hot' },
    ];

    sdEls.aiStats.innerHTML = stats.map(s=>`
      <div class="sd-stat-card">
        <div class="sd-stat-label">${s.label}</div>
        <div class="sd-stat-value ${s.class}">${s.value}</div>
        <div class="sd-stat-sub">${s.sub}</div>
      </div>
    `).join('');

    const matchRows = realMatches.map(m=>{
      const a = m.left, b = m.right;
      const diff = Math.abs(a.points - b.points);
      const pct = totalSpread > 0 ? diff / totalSpread : 0;
      let tagClass, tagText;
      if (diff <= tossupThreshold) { tagClass = 'tossup'; tagText = 'TOSS-UP'; }
      else if (diff <= upsetThreshold) { tagClass = 'upset'; tagText = 'UPSET RISK'; }
      else { tagClass = 'predicted'; tagText = 'CLEAR FAV'; }
      const higher = a.points >= b.points ? a : b;
      const lower  = a.points >= b.points ? b : a;
      return { a, b, diff, pct, tagClass, tagText, higher, lower };
    });

    const sorted = matchRows.slice().sort((a,b) => a.diff - b.diff);

    sdEls.aiMatchAnalysis.innerHTML = sorted.map((m,i)=>`
      <div class="ma-row">
        <div class="ma-num">Match ${i+1}</div>
        <div class="ma-teams"><strong>${sdEscapeHtml(m.higher.team)}</strong> vs ${sdEscapeHtml(m.lower.team)}</div>
        <div class="ma-bar-wrap">
          <div class="ma-bar"><div class="ma-bar-fill" style="width:${Math.max(5, m.pct * 100).toFixed(1)}%"></div></div>
        </div>
        <div class="ma-delta">Î” ${m.diff.toFixed(1)}</div>
        <span class="ma-tag ${m.tagClass}">${m.tagText}</span>
      </div>
    `).join('');

    const insights = [];
    const upsets   = matchRows.filter(m=>m.tagClass==='upset').length;
    const tossups  = matchRows.filter(m=>m.tagClass==='tossup').length;
    const predicted = matchRows.filter(m=>m.tagClass==='predicted').length;

    if (tossups > 0)   insights.push({type:'warn', icon:'âš¡', text:`<strong>${tossups} toss-up match(es)</strong> detected â€” point gap under ${tossupThreshold.toFixed(1)} pts.`});
    if (upsets > 0)    insights.push({type:'warn', icon:'ğŸ¯', text:`<strong>${upsets} upset-risk match(es)</strong> â€” lower seeds have a real shot.`});
    if (predicted > 0) insights.push({type:'ok',   icon:'âœ“',  text:`<strong>${predicted} match(es)</strong> heavily favor the higher seed.`});
    if (topTeam && bottomTeam) insights.push({type:'info', icon:'ğŸ“Š', text:`Point spread: <strong>${totalSpread.toFixed(1)} pts</strong> (${sdEscapeHtml(topTeam.team)} â†’ ${sdEscapeHtml(bottomTeam.team)}).`});

    const regions = Object.keys(regionCounts);
    if (regions.length > 1) insights.push({type:'info', icon:'ğŸŒ', text:`Multi-region bracket: ${regions.map(r=>`<strong>${r}</strong> (${regionCounts[r]})`).join(', ')}.`});

    const highStreak = teams.filter(t => (t.streak||0) >= 3);
    if (highStreak.length) insights.push({type:'warn', icon:'ğŸ”¥', text:`<strong>${highStreak.length} team(s)</strong> on a win streak of 3+: ${highStreak.map(t=>sdEscapeHtml(t.team)).join(', ')}.`});

    sdEls.aiInsights.innerHTML = insights.map(i=>`
      <div class="insight ${i.type}">
        <span class="insight-icon">${i.icon}</span>
        <div>${i.text}</div>
      </div>
    `).join('') || '<div class="insight info"><span class="insight-icon">â„¹</span><div>No significant insights â€” bracket looks balanced.</div></div>';

    sdEls.aiPanel.classList.add('visible');
    setTimeout(()=>sdEls.aiPanel.scrollIntoView({behavior:'smooth', block:'nearest'}), 100);
  }

  function sdGenerate(){
    const teams = sdGetSelectedTeamsSorted();
    if (teams.length < 2){ sdEls.genInfo.textContent = 'âš  Select at least 2 teams.'; return; }
    const pairs = sdBuildSeededPairs(teams);
    const matches = sdBuildMatchesRandomSidesAndWine(pairs);
    sdLastTeams = teams;
    sdLastMatches = matches;

    sdRenderSelectedTable(teams);
    sdRenderMatches(matches);

    sdLastOutputText = sdBuildOutputText(teams, matches);
    sdEls.copy.disabled = false;
    sdEls.download.disabled = false;
    sdEls.regenerate.disabled = false;
    sdEls.analyzeBtn.disabled = false;

    const byeCount = teams.length % 2 === 1 ? 1 : 0;
    sdEls.genInfo.textContent = `âœ“ Generated ${matches.length} match(es)` + (byeCount ? ' Â· 1 BYE.' : '.');
    sdEls.aiPanel.classList.remove('visible');
  }

  function sdFindColumnKey(obj, wanted){
    const keys = Object.keys(obj);
    const lower = wanted.toLowerCase();
    for (const k of keys) if (k.toLowerCase()===lower) return k;
    for (const k of keys) if (k.toLowerCase().includes(lower)) return k;
    return null;
  }

  async function sdLoadRankingFromXlsx(){
    if (!window.XLSX) throw new Error('XLSX library did not load.');
    const res = await fetch(RANKING_PATH, {cache:'no-store'});
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const buf = await res.arrayBuffer();
    const wb = XLSX.read(buf, {type:'array'});
    const ws = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(ws, {defval:''});
    if (!rows.length) throw new Error('Empty sheet.');

    const teamKey    = sdFindColumnKey(rows[0], 'Team');
    const pointsKey  = sdFindColumnKey(rows[0], 'Points');
    if (!teamKey || !pointsKey) throw new Error('Could not find Team and Points columns.');

    const tierKey    = sdFindColumnKey(rows[0], 'Tier');
    const regionKey  = sdFindColumnKey(rows[0], 'Region');
    const streakKey  = sdFindColumnKey(rows[0], 'Streak');

    const data = [];
    for (const r of rows){
      const team = sdNormalizeStr(r[teamKey]);
      if (!team) continue;
      data.push({
        team,
        points: sdParseNumber(r[pointsKey]),
        tier:   tierKey   ? sdNormalizeStr(r[tierKey])  : '',
        region: regionKey ? sdNormalizeStr(r[regionKey]): '',
        streak: streakKey ? sdParseNumber(r[streakKey]) : 0,
      });
    }

    const sorted = sdSortRanking(data);
    sorted.forEach((t,i) => t.seed = i+1);
    return sorted;
  }

  async function sdInit(){
    sdEls.filter.addEventListener('input', sdRenderTeamList);
    sdEls.regionFilter.addEventListener('change', sdRenderTeamList);
    sdEls.tierFilter.addEventListener('change', sdRenderTeamList);
    sdEls.applyBulk.addEventListener('click', sdApplyBulkNames);
    sdEls.selectAll.addEventListener('click', sdSelectAllVisible);
    sdEls.clearSel.addEventListener('click', sdClearSelection);
    sdEls.generate.addEventListener('click', sdGenerate);
    sdEls.regenerate.addEventListener('click', sdGenerate);

    sdEls.analyzeBtn.addEventListener('click', ()=>{
      if (sdLastMatches.length) sdBuildAIAnalysis(sdLastTeams, sdLastMatches);
    });
    sdEls.closeAI.addEventListener('click', ()=> sdEls.aiPanel.classList.remove('visible'));

    sdEls.copy.addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(sdLastOutputText);
        sdEls.genInfo.textContent = 'âœ“ Copied to clipboard!';
      } catch { sdEls.genInfo.textContent = 'âš  Could not copy automatically.'; }
    });

    sdEls.download.addEventListener('click', ()=>{
      const blob = new Blob([sdLastOutputText], {type:'text/plain;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'matches.txt';
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
    });

    sdEls.useManual.addEventListener('click', ()=>{
      const data = sdParseManualLines(sdEls.manualInput.value);
      if (data.length < 2){ sdEls.manualStatus.textContent = 'âš  Paste at least 2 valid lines.'; return; }
      ranking = sdSortRanking(data).map((t,i)=>({...t, seed:i+1}));
      sdSetLoadedState(true, `Using pasted data (${ranking.length} teams).`);
      sdEls.manualStatus.textContent = `âœ“ ${ranking.length} loaded.`;
      sdPopulateFilters(); sdRenderTeamList(); sdUpdateSelCount();
    });

    try{
      ranking = await sdLoadRankingFromXlsx();
      sdSetLoadedState(true, `Loaded ${ranking.length} teams from ${RANKING_PATH}.`);
      sdEls.fallbackBox.open = false;
    } catch(err){
      console.warn(err);
      sdSetLoadedState(false, `Failed to read ${RANKING_PATH}: ${err.message}. Use manual paste below.`);
      sdEls.fallbackBox.open = true;
    }

    sdPopulateFilters(); sdUpdateSelCount(); sdRenderTeamList();
  }

  document.addEventListener('DOMContentLoaded', sdInit);
</script>

</body>
</html>
